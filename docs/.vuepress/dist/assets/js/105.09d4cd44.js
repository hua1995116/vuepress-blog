(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{493:function(t,n,s){"use strict";s.r(n);var e=s(44),a=Object(e.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nginx-https升级http2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-https升级http2"}},[t._v("#")]),t._v(" nginx-https升级http2")]),t._v(" "),s("h2",{attrs:{id:"概要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[t._v("#")]),t._v(" 概要")]),t._v(" "),s("p",[t._v("HTTP/2 （原名HTTP/2.0）即超文本传输协议 2.0，是下一代HTTP协议。是由互联网工程任务组（IETF）的Hypertext Transfer Protocol Bis (httpbis)工作小组进行开发。是自1999年http1.1发布后的首个更新。HTTP 2.0在2013年8月进行首次合作共事性测试。在开放互联网上HTTP 2.0将只用于https://网址，而 http://网址将继续使用HTTP/1，目的是在开放互联网上增加使用加密技术，以提供强有力的保护去遏制主动攻击。DANE RFC6698允许域名管理员不通过第三方CA自行发行证书。")]),t._v(" "),s("h2",{attrs:{id:"前提"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前提"}},[t._v("#")]),t._v(" 前提")]),t._v(" "),s("p",[t._v("https 升级到http2两个必要条件\nnginx 大于等于1.9.5\nopenssl 大于等于 1.0.2\n参考：https://www.nginx.com/blog/supporting-http2-google-chrome-users/\n升级openssl\nhttps://www.openssl.org/source/")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("wget https://www.openssl.org/source/openssl-1.1.0c.tar.gz\n\ntar -zxf openssl-1.1.0c.tar.gz\n\ncd openssl-1.1.0c\n\n./config\n\nmake\n\nmake install\n\n#把旧版本的openssl重命名\nmv /usr/bin/openssl /usr/bin/openssl.bak\n\n#设置软连接指向刚编译好的新版本的openssl-1.1.0c\nln -s /usr/local/bin/openssl /usr/bin/openssl\n\n#添加libssl.so.1.1的软链接\nln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1\nln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1\n\n#查看openssl版本\nopenssl version\n")])])]),s("h3",{attrs:{id:"安装nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装nginx"}},[t._v("#")]),t._v(" 安装nginx")]),t._v(" "),s("p",[t._v("nginx有两种情况，一种是基于你已经安装过nginx，但是你的版本过低，或者没有安装一些额外的扩展导致无法升级，另外一种是还未安装。\n1.重新安装nginx\nnginx 编译参数\n官网\nhttp://nginx.org/en/docs/configure.html\n中文版\nhttp://www.ttlsa.com/nginx/nginx-configure-descriptions/")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#进入你存在目录your path替换成你自己服务器的目录\ncd your path\n#下载\nwget http://nginx.org/download/nginx-1.15.5.tar.gz\n#解压\ntar zxvf nginx-1.15.5.tar.gz\n#进入源码目录\ncd nginx-1.15.5\n\n#参数\n./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-http_gzip_static_module  --with-http_sub_module --with-openssl=/root/openssl-1.1.0c #对应openssl源码解压后的路径\n\nmake && make install\n\n")])])]),s("p",[t._v("2.平滑升级nginx到最新的稳定版")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#进入你存在目录your path替换成你自己服务器的目录\ncd your path\n#下载\nwget http://nginx.org/download/nginx-1.15.5.tar.gz\n#解压\ntar zxvf nginx-1.15.5.tar.gz\n#进入源码目录\ncd nginx-1.15.5\n#参数\n./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_v2_module --with-http_gzip_static_module  --with-http_sub_module --with-openssl=/root/openssl-1.1.0c #对应openssl源码解压后的路径\nmake\n#不要执行make install\nmv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old\n#将新的编译好的文件拷贝\ncp objs/nginx /usr/local/nginx/sbin/\n#在源码目录执行make upgrade开始升级\nmake upgrade\n#查看下版本\nnginx -V\n\n")])])]),s("h3",{attrs:{id:"配置http2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置http2"}},[t._v("#")]),t._v(" 配置http2")]),t._v(" "),s("p",[t._v("下面配置http2的nginx.conf部分代码。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server {\n\n\tlisten 443 ssl http2;\n\tserver_name domain.com;\n\n\tssl_certificate /path/to/public.crt;\n\tssl_certificate_key /path/to/private.key;\n\t\n\tssl_session_timeout 5m; \n\tssl_protocols TLSv1 TLSv1.1 TLSv1.2; \n\tssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;     \n\tssl_prefer_server_ciphers on;\n\t\n\n")])])]),s("p",[t._v("大功告成。下面看效果图。")]),t._v(" "),s("p",[t._v("效果图")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1679de4dfd9c54f2.jpg",alt:"1679de4dfd9c54f2"}})]),t._v(" "),s("p",[t._v("如果没有协议这一栏，可以右键工具栏。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1679de75bd365cae.jpg",alt:"1679de75bd365cae"}})]),t._v(" "),s("p",[t._v("参考资料\nhttps://blog.fazero.me/2017/01/06/upgrate-nginx-and-use-http2/")])])}),[],!1,null,null,null);n.default=a.exports}}]);