(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{492:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"mongodb系列一-replica-set-集群搭建实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb系列一-replica-set-集群搭建实战"}},[t._v("#")]),t._v(" MongoDB系列一: Replica Set 集群搭建实战")]),t._v(" "),a("p",[t._v("随着内部产品业务的搭建，单机的mongo已经无法满足生产需求，对于单机迁移、损坏等问题，简单的单机数据备份已经无法满足，因为采用了集群方式来满足容灾以及数据快速恢复等功能，下面我就来讲讲如何搭建集群来避免这些问题。")]),t._v(" "),a("h3",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),a("p",[t._v("机器信息: 3 台机器")]),t._v(" "),a("p",[t._v("mongo1\nmongo2\nmongo3")]),t._v(" "),a("p",[t._v("环境: CentOS 6.5")]),t._v(" "),a("h3",{attrs:{id:"采用策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#采用策略"}},[t._v("#")]),t._v(" 采用策略")]),t._v(" "),a("p",[t._v("Mongo有三种集群方式\n1.Replica Set副本\n2.Sharding分片\n3.Master-slave主备")]),t._v(" "),a("p",[t._v("比较常用的为1，2两种方式， 在日后的篇章中将详细介绍两者的区别。")]),t._v(" "),a("p",[t._v("当前我们采用的是  Replica Set 搭建方式。这是官方教程，我们会跟着官方教程，以及对官方未说明的一些信息进行补充。https://docs.mongodb.com/manual/tutorial/deploy-replica-set/#overview")]),t._v(" "),a("h3",{attrs:{id:"简述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简述"}},[t._v("#")]),t._v(" 简述")]),t._v(" "),a("p",[t._v("副本集是一组维护相同数据集的 mongo 实例。副本集包含多个数据节点和一个仲裁节点。在数据承载节点中，只能含有一个主节点，其他节点被视为复制节点。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://docs.mongodb.com/manual/_images/replica-set-read-write-operations-primary.bakedsvg.svg",alt:""}})]),t._v(" "),a("p",[t._v("复制节点复制主节点的 oplog 并将操作应用于其数据集，使得复制节点成为主节点的一个镜像。 如果主节点停止时候，在复制节点中将会选出新的主节点。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://docs.mongodb.com/manual/_images/replica-set-primary-with-two-secondaries.bakedsvg.svg",alt:""}})]),t._v(" "),a("p",[t._v("自动故障转移，当主节点与集合中的其他成员通信的时间超过配置的electionTimeoutMillis期间（默认为10秒）时，符合条件的复制节点将会被选举成新主节点。 群集尝试完成新主节点的选举并恢复正常操作。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://docs.mongodb.com/manual/_images/replica-set-trigger-election.bakedsvg.svg",alt:""}})]),t._v(" "),a("p",[t._v("写操作，默认情况下，客户端从主节点读取， 但是，客户端可以设置从复制节点读取。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://docs.mongodb.com/manual/_images/replica-set-read-preference-secondary.bakedsvg.svg",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[t._v("#")]),t._v(" 特性")]),t._v(" "),a("p",[t._v("优势")]),t._v(" "),a("p",[t._v("1.提供容错功能，在主节点故障时，复制节点代替主节点")]),t._v(" "),a("p",[t._v("2.数据的快速恢复")]),t._v(" "),a("p",[t._v("3.增加节点可提高读能力")]),t._v(" "),a("p",[t._v("4.快速横向扩展")]),t._v(" "),a("p",[t._v("劣势")]),t._v(" "),a("p",[t._v("1.所有写操作都从主节点进行，增加节点无法提高写能力")]),t._v(" "),a("p",[t._v("2.每个节点都是完整备份，数据冗余")]),t._v(" "),a("h3",{attrs:{id:"基础搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础搭建"}},[t._v("#")]),t._v(" 基础搭建")]),t._v(" "),a("p",[t._v("分别在 3 台机器安装 mongo")]),t._v(" "),a("p",[t._v("用户权限")]),t._v(" "),a("p",[t._v("mongo1")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.4.6.tgz\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" zxvf mongodb-linux-x86_64-3.4.6.tgz\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" mongodb-linux-x86_64-3.4.6 mongodb\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" mongodb\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" data/db\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" data/logs\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" data/mongodb.log\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" data\n")])])]),a("p",[t._v("在这里我们采用配置文件的方式启动，先不配置验证，等设置完用户组后，再进行， 为了安全考虑，我们将修改默认端口，分别使用 8410,8411,8412。  "),a("code",[t._v("[your replSet name]")]),t._v(" 改成你自己 replSet 的名字， 例如 "),a("code",[t._v("rs0")]),t._v(" (自己取)")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("vim mongodb.conf\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#端口号")]),t._v("\nport "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8410")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群名字")]),t._v("\nreplSet "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("your replSet name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据目录(自己刚才设置的位置)")]),t._v("\ndbpath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ~/mongodb/data/db\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#日志目录(自己刚才设置的位置))")]),t._v("\nlogpath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ~/mongodb/data/logs/mongodb.log\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置后台运行")]),t._v("\nfork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#日志输出方式")]),t._v("\nlogappend "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启认证")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#auth = true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安全文件地址")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#keyFile = ~/mongodb/data/keyFile")]),t._v("\n")])])]),a("p",[t._v("启动mongo")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd ..\n./bin/mongod --config ~/mongodb/data/mongodb.conf\n")])])]),a("p",[t._v("mongo2,mongo3 同 mongo1。只需要修改端口, 其他都与 mongo1 一样的步骤。")]),t._v(" "),a("p",[t._v("mongo2")]),t._v(" "),a("p",[t._v("mongodb.conf")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("...\nport = 8411\n...\n")])])]),a("p",[t._v("mongo3")]),t._v(" "),a("p",[t._v("mongodb.conf")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("...\nport = 8412\n...\n")])])]),a("p",[t._v("在三台机器都启动好后，我们来到 mongo1 机器。")]),t._v(" "),a("p",[t._v("连接 mongodb")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("./bin/mongo 127.0.0.1:8410\n")])])]),a("p",[t._v("配置集群(mongo1为你的机器地址)")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("cfg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"[your replSet name]"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"members"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongo1:8410"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("效果如图:\n"),a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567682388618.jpg",alt:"1567682388618.jpg"}})]),t._v(" "),a("p",[t._v("运行 "),a("code",[t._v("rs.status()")]),t._v(" 查看状态。")]),t._v(" "),a("p",[t._v("health: 1 代表正常 0 代表异常， stateStr 为描述主节点或者复制节点。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567682478469.jpg",alt:"1567682478469.jpg"}})]),t._v(" "),a("p",[t._v("现在我们已经添加了一个主节点了，接下来继续添加剩余的两个节点。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567682673974.jpg",alt:"1567682673974.jpg"}})]),t._v(" "),a("p",[t._v("运行 "),a("code",[t._v("rs.status()")]),t._v(" 查看状态。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567682754525.jpg",alt:"1567682754525.jpg"}})]),t._v(" "),a("p",[t._v("到现在我们已经完成了我们的集群搭建。")]),t._v(" "),a("p",[t._v("接下来我们就要来验证下我们的数据同步问题。")]),t._v(" "),a("p",[t._v("继续保持在主节点连接状态。")]),t._v(" "),a("p",[t._v("创建一条测试数据。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567683075113.jpg",alt:"1567683075113.jpg"}})]),t._v(" "),a("p",[t._v("退出我们的主节点连接，连接复制节点。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" ./bin/mongo mongo2:8411\n")])])]),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567683192236.jpg",alt:"1567683192236.jpg"}})]),t._v(" "),a("p",[t._v("发现我们并不能直接查看")]),t._v(" "),a("p",[t._v("原因是: mongodb默认是从主节点读写数据的。")]),t._v(" "),a("p",[t._v("我们对复制节点进行进行设置。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.getMongo().setSlaveOk();\n\ndb.test.find();\n\n// { "_id" : ObjectId("5d70f1f19384bf8d850e2042"), "test" : "123" }\n\n')])])]),a("p",[t._v("数据已经从主节点同步过来了。")]),t._v(" "),a("p",[t._v("模拟宕机 mongo 故障")]),t._v(" "),a("p",[t._v("我们将主节点停止。 (也可以直接kill，但是推荐安全退出)")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("./bin/mongo "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:8410\n\nuse admin\n\ndb.shutdownServer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),a("p",[t._v("登录我们的复制mongo2来进行查看，确认是否成功迁移了 mongo 。")]),t._v(" "),a("p",[t._v("来到mongo2")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("./bin/mongo 127.0.0.1:8411\n\nrs.status();\n")])])]),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567683538699.jpg",alt:"1567683538699.jpg"}})]),t._v(" "),a("p",[t._v("可以看到通过选举，mongo2 成功成为主节点。")]),t._v(" "),a("p",[t._v("重启 mongo1 ， 连接实例")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd ~\n\n./bin/mongod --config /opt/meituan/mongodb/data/mongodb.conf\n\n./bin/mongo 127.0.0.1:8410\n\nrs.status();\n")])])]),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567683684469.jpg",alt:"1567683684469.jpg"}})]),t._v(" "),a("p",[t._v("原来的 mongo1 成功地成为了 mongo 2 的复制节点。")]),t._v(" "),a("p",[t._v("mongoose 连接测试")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongoose "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongoose"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uri "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb://mongo1:8410,mongo2:8411,mongo3:8412/test?authSource=admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" opts "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  poolSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  auto_reconnect"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  useNewUrlParser"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  keepAlive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  replicaSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"banmars"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  readPreference"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secondaryPreferred"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nglobal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connection "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"open"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dbopen"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),a("p",[t._v("到此我们的 mongo 集群已经搭建并且测试完成，然后就拿着集群兴高采烈地去进行使用，但是发现，因为集群到现在没有设置任何安全认证，任意用户可以进行登录修改数据。这可是个大隐患，你的库随时都有被删除的风险。。。这可不好交代，所以我们接下来讲解如何搭建一个安全的 mongodb 环境。")]),t._v(" "),a("h3",{attrs:{id:"安全验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全验证"}},[t._v("#")]),t._v(" 安全验证")]),t._v(" "),a("p",[t._v("首先来到主节点(mongo2，刚才测试的时候 mongo2 成为主节点了)")]),t._v(" "),a("p",[t._v("创建管理员用户 ("),a("a",{attrs:{href:"https://blog.csdn.net/WI_232995/article/details/78881408",target:"_blank",rel:"noopener noreferrer"}},[t._v("权限说明"),a("OutboundLink")],1),t._v(")")]),t._v(" "),a("p",[t._v("管理员用户，用来添加用户以及授权")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('use admin\n\ndb.createUser( {\n user: "root",\n pwd: "root",\n roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]\n});\n')])])]),a("p",[t._v("集群管理用户，用来查看集群状态")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.createUser(\n  {\n    "user" : "cluster",\n    "pwd" : "cluster",\n    roles: [ { "role" : "clusterAdmin", "db" : "admin" } ]\n  }\n)\n')])])]),a("p",[t._v("https://docs.mongodb.com/manual/tutorial/deploy-replica-set-with-keyfile-access-control/#deploy-repl-set-with-auth\n查看官网我们可以看到 mongo 采用的是 keyFile 的方式")]),t._v(" "),a("p",[t._v("由于一开始我没有采用这个方式，直接采用 auth=true 的方式，导致一直报以下的错误。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Error in heartbeat request to X.X.X.X:8410; Unauthorized: not authorized on admin to execute command\n")])])]),a("p",[t._v("生成 keyFile")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd ~\ncd mongodb\nopenssl rand -base64 756 > data/keyFile\nchmod 400 data/keyFile\nvim data/mongodb.conf\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#端口号")]),t._v("\nport "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8410")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群名字")]),t._v("\nreplSet "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("your replSet name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#数据目录(自己刚才设置的位置)")]),t._v("\ndbpath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ~/mongodb/data/db\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#日志目录(自己刚才设置的位置))")]),t._v("\nlogpath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ~/mongodb/data/logs/mongodb.log\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置后台运行")]),t._v("\nfork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#日志输出方式")]),t._v("\nlogappend "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启认证")]),t._v("\nauth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安全文件地址")]),t._v("\nkeyFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ~/mongodb/data/keyFile\n")])])]),a("p",[t._v("将 auth 开启， 指定 keyFile 路径。")]),t._v(" "),a("p",[t._v("将 mongo1 停止，再重启。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("./bin/mongo 127.0.0.1:8410\n\nuse admin\n\ndb.shutdownServer()\n\n./bin/mongod --config ~/mongodb/data/mongodb.conf\n\n")])])]),a("p",[t._v("将 mongo1中的 keyFile 文件拷贝到 mongo2 以及 mongo3.")]),t._v(" "),a("p",[t._v("这里我采用的是 rsync 方式。")]),t._v(" "),a("p",[t._v("所以我们还得配置 ssh。(你也可以采用其他方式，我这里为了后续同步方便采用了 ssh )")]),t._v(" "),a("p",[t._v("mongo1")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd ~/.ssh\nssh-keygen\n\n一路回车...\n\ncat id_rsa.pub\n\n复制内容\n")])])]),a("p",[t._v("mongo2")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd ~/.ssh/\n\nvim authorized_keys\n\n")])])]),a("p",[t._v("将刚才复制的添加最后。")]),t._v(" "),a("p",[t._v("mongo3 同 mongo2")]),t._v(" "),a("p",[t._v("mongo1")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd ~/mongodb\n\nrsync -Cavzt ./data/keyFile mongodb02:~/mongodb/data/\nrsync -Cavzt ./data/keyFile mongodb03:~/mongodb/data/\n")])])]),a("p",[t._v("分别到mongo2，mongo3，")]),t._v(" "),a("p",[t._v("编辑配置文件")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启认证")]),t._v("\nauth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安全文件地址")]),t._v("\nkeyFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ~/mongodb/data/keyFile\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("p",[t._v("重启 mongo2,mongo3 上的 mongo实例")]),t._v(" "),a("p",[t._v("来到 mongo1")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("./bin/mongo 127.0.0.1:8410\n")])])]),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567686047066.jpg",alt:"1567686047066.jpg"}})]),t._v(" "),a("p",[t._v("我们看到通过不验证的方式登录已经无法查看信息了。")]),t._v(" "),a("p",[t._v("下面我们用认证方式来进行登录。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('./bin/mongo 127.0.0.1:8410 -u "root" -p "root" --authenticationDatabase "admin"\n')])])]),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567686155667.jpg",alt:"1567686155667.jpg"}})]),t._v(" "),a("p",[t._v("通过认证方式登录已经正常使用了。")]),t._v(" "),a("p",[t._v("退出登录，使用集群管理员登录。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('./bin/mongo 127.0.0.1:8410 -u "cluster" -p "cluster" --authenticationDatabase "admin"\n')])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("rs.status();\n")])])]),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1567686701852.jpg",alt:"1567686701852.jpg"}})]),t._v(" "),a("p",[t._v("三台机器已经都正常运行了。")]),t._v(" "),a("p",[t._v("还记得我们一开始创建的 test 集合吗。")]),t._v(" "),a("p",[t._v("我们给它创建一个用户来进行管理。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.createUser(\n  {\n    "user" : "test",\n    "pwd" : "test",\n    roles: [ { "role" : "read", "db" : "test" }, { "role" : "readWrite", "db" : "test" } ]\n  }\n)\n')])])]),a("p",[t._v("mongoose 测试")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mongoose "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongoose"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uri "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mongodb://test:test@10.48.172.11:8410,10.48.181.145:8411,10.48.144.74:8412/test?authSource=admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" opts "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  poolSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  auto_reconnect"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  useNewUrlParser"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  keepAlive"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  replicaSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"banmars"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  readPreference"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secondaryPreferred"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nglobal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uri"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connection "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"open"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dbopen"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Schema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" TestSchema "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Test "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mongoose"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("model")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" TestSchema"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" testModal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  testModal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("save")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'success'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("最终效果")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://s3.qiufeng.blue/blog/1568188107165.jpg",alt:"1568188107165.jpg"}})]),t._v(" "),a("p",[t._v("到此，真正地结束了本教程，我们可以愉快地拿着集群去交代了。。。")]),t._v(" "),a("p",[t._v("下期预告")]),t._v(" "),a("p",[t._v("MongoDB系列二: Sharded Cluster 集群搭建实战")]),t._v(" "),a("h3",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[t._v("https://blog.csdn.net/WI_232995/article/details/78881408")]),t._v(" "),a("p",[t._v("https://docs.mongodb.com/manual/tutorial/deploy-replica-set/#deploy-a-replica-set")])])}),[],!1,null,null,null);s.default=e.exports}}]);