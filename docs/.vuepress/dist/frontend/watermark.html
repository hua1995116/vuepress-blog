<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从破解某定设计网站谈前端水印(详细教程) | 秋风的笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fd8e413c5ce47d78c95f742fc41a7118";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <meta name="description" content="">
    
    <link rel="preload" href="https://cdn.qiufeng.blue/assets/css/0.styles.29336953.css" as="style"><link rel="preload" href="https://cdn.qiufeng.blue/assets/js/app.41b736e4.js" as="script"><link rel="preload" href="https://cdn.qiufeng.blue/assets/js/3.1c3cb04e.js" as="script"><link rel="preload" href="https://cdn.qiufeng.blue/assets/js/2.bf4393a2.js" as="script"><link rel="preload" href="https://cdn.qiufeng.blue/assets/js/73.6f122591.js" as="script"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/10.bf58e465.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/100.25ccabb7.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/101.39899c8d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/102.2742e733.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/103.b2350908.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/104.89ca605c.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/105.09d4cd44.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/106.f4d4cacc.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/107.fed3eeb5.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/108.b8170a78.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/109.405c46ab.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/11.ffe69b2d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/110.e95d6f22.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/111.54775e5e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/112.e4de034e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/113.6dbf9c25.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/114.9a9ae0a1.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/115.c0fa0fed.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/116.913f1c85.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/117.e1036e3e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/118.65871b43.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/119.89d7605e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/12.add6b35c.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/120.51655563.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/121.33e5eda0.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/122.34a8dd52.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/123.68c1118e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/124.639f41e3.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/125.4a047b58.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/126.1c633eef.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/127.e4502464.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/128.2b32e0b0.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/129.b519134c.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/13.cd5a7ebb.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/130.76889ac7.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/131.9c9b8478.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/132.bc074a48.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/133.36781ad5.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/134.8eae5caf.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/135.cfbc0acd.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/136.167be017.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/137.a738c0b9.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/138.42ebd5bc.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/139.bc1ecb45.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/14.992d9387.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/140.374d9887.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/141.cd93e171.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/142.fee03a78.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/143.cdd99fe8.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/144.b74dc095.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/145.8aaba8b9.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/146.8bfcae9d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/147.ba4c94bc.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/148.384872a1.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/149.7e8455b0.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/15.3f79a7f8.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/150.88058b7e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/151.38b67be7.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/152.be34e7f8.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/153.412aa743.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/154.33d50b3d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/16.f97f7bfd.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/17.db677e3c.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/18.1913e4cc.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/19.e03cb958.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/20.95527118.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/21.ce897d67.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/22.981ef776.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/23.730a3d06.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/24.c1a7254e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/25.14a9a42d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/26.8dbf7c47.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/27.bd1625cc.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/28.8dfa016f.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/29.bae4ec1f.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/30.1cc2e3da.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/31.cae9c629.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/32.13014d37.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/33.32d62735.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/34.af493146.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/35.aa5264c8.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/36.f14b4c3d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/37.949d7cb5.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/38.e040e214.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/39.a0e5ec00.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/4.51060f90.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/40.b1e1619d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/41.8dafa68f.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/42.8960edd3.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/43.838bb5b0.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/44.6cc49bda.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/45.ba596489.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/46.fc8dd904.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/47.f2cd066f.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/48.2ad5499e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/49.f22666c6.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/5.dc096b09.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/50.d32003da.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/51.e3dd41ac.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/52.d79a40ea.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/53.f99e16e5.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/54.c20e45cc.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/55.ce041e6e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/56.fb788519.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/57.b3a42ce9.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/58.c58c2d26.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/59.6dd1ccde.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/6.672abf41.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/60.fbe83a41.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/61.4eb8f9a4.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/62.63ac632a.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/63.a19a62c6.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/64.cfa3c9ce.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/65.4860422b.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/66.c61dcdca.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/67.f96e3fe9.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/68.a0fc9704.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/69.1f336f9a.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/7.959da92e.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/70.700af316.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/71.185b8620.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/72.967837aa.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/74.e92f6d8d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/75.eb121f17.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/76.510af249.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/77.d72e07e6.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/78.063c2882.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/79.48352856.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/8.09c2e0dd.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/80.65de739c.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/81.06d08794.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/82.0d389ca5.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/83.843fb342.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/84.a67136dd.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/85.31d708d9.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/86.64360ead.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/87.b867ab27.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/88.7e7ba4c2.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/89.31e8cbab.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/9.4b6ccd84.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/90.426f6abf.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/91.7102fa9d.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/92.9c290808.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/93.57cf2fc4.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/94.4efa0980.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/95.b17d2c48.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/96.20a235fd.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/97.be606aba.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/98.5b65a57c.js"><link rel="prefetch" href="https://cdn.qiufeng.blue/assets/js/99.b53d3b43.js">
    <link rel="stylesheet" href="https://cdn.qiufeng.blue/assets/css/0.styles.29336953.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">秋风的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端系列" class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link router-link-active">js文章</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">react实践</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue实践</a></li><li class="dropdown-item"><!----> <a href="/debug/" class="nav-link">debug系列</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">webpack系列</a></li><li class="dropdown-item"><!----> <a href="/canvas/" class="nav-link">canvas系列</a></li></ul></div></div><div class="nav-item"><a href="/svelte/" class="nav-link">Svelte系列</a></div><div class="nav-item"><a href="/three/" class="nav-link">Three.js系列</a></div><div class="nav-item"><a href="/node/" class="nav-link">Node系列</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/op/" class="nav-link">前端运维</a></div><div class="nav-item"><a href="/open/" class="nav-link">开源项目</a></div> <a href="https://github.com/hua1995116/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端系列" class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link router-link-active">js文章</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">react实践</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue实践</a></li><li class="dropdown-item"><!----> <a href="/debug/" class="nav-link">debug系列</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">webpack系列</a></li><li class="dropdown-item"><!----> <a href="/canvas/" class="nav-link">canvas系列</a></li></ul></div></div><div class="nav-item"><a href="/svelte/" class="nav-link">Svelte系列</a></div><div class="nav-item"><a href="/three/" class="nav-link">Three.js系列</a></div><div class="nav-item"><a href="/node/" class="nav-link">Node系列</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/op/" class="nav-link">前端运维</a></div><div class="nav-item"><a href="/open/" class="nav-link">开源项目</a></div> <a href="https://github.com/hua1995116/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div style="padding-left:1.5rem;"><div class="qr"><img src="https://s3.qiufeng.blue/blog/erweima.jpg" alt="秋风的比较" width="120" height="120" loading="lazy"> <p class="we-intro">
    如果你对前端，Node，开源项目感兴趣请关注我的公众号 <a target="_blank" href="https://mp.weixin.qq.com/s/pKoliWlgtV-qm6orbyTz0Q">秋风的笔记</a>。
  </p></div></div> <ul class="sidebar-links"><li><a href="/frontend/chrome-extension-source-install.html" class="sidebar-link">从源码安装谷歌浏览器插件</a></li><li><a href="/frontend/gitee-guide.html" class="sidebar-link">万一 Github 不让用了，Gitee同步指南请收好</a></li><li><a href="/frontend/markdown-resume.html" class="sidebar-link">只用 Markdown 就写出好看的简历，在线简历应用闪亮登场！</a></li><li><a href="/frontend/frontend-books.html" class="sidebar-link">2021前端学习路径书单—自我成长之路</a></li><li><a href="/frontend/2020-state-of-js.html" class="sidebar-link">请查收 2020 全球 JS 调查结果</a></li><li><a href="/frontend/2020-css.html" class="sidebar-link">2020年度CSS报告新鲜出炉，从业者平均年薪35w</a></li><li><a href="/frontend/baidu-kaifa.html" class="sidebar-link">2021年，推荐一个百度新出开发专用搜索引擎，没有广告！</a></li><li><a href="/frontend/chrome-frontend.html" class="sidebar-link">2021 chrome 插件推荐</a></li><li><a href="/frontend/watermark.html" aria-current="page" class="active sidebar-link">从破解某定设计网站谈前端水印(详细教程)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/watermark.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#明水印" class="sidebar-link">明水印</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/watermark.html#明水印的生成" class="sidebar-link">明水印的生成</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#div实现" class="sidebar-link">div实现</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#背景图实现" class="sidebar-link">背景图实现</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#明水印的破解一" class="sidebar-link">明水印的破解一</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#明水印的防御" class="sidebar-link">明水印的防御</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#明水印的破解二" class="sidebar-link">明水印的破解二</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#破解实践" class="sidebar-link">破解实践</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#暗水印" class="sidebar-link">暗水印</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/watermark.html#解码过程" class="sidebar-link">解码过程</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#编码过程" class="sidebar-link">编码过程</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#破解实践-2" class="sidebar-link">破解实践</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#攻击实验" class="sidebar-link">攻击实验</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#最后" class="sidebar-link">最后</a></li><li class="sidebar-sub-header"><a href="/frontend/watermark.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/frontend/node-sass-eprecated.html" class="sidebar-link">Node Sass 弃用，以 Dart Sass 代替</a></li><li><a href="/frontend/friend-vscode.html" class="sidebar-link">这个插件居然让vscode变成了交友工具(以码会友)</a></li><li><a href="/frontend/git-10-up.html" class="sidebar-link">🔱 几个你不知道的Git小命令,收获快乐。</a></li><li><a href="/frontend/best-practices-aysnc.html" class="sidebar-link">ES2017 异步函数最佳实践（`async` /`await`）</a></li><li><a href="/frontend/best-practices-es6-promise.html" class="sidebar-link">ES6 Promise 的最佳实践</a></li><li><a href="/frontend/collapsing-margins.html" class="sidebar-link">[重拾CSS]一道面试题来看伪元素、包含块和高度坍塌</a></li><li><a href="/frontend/codepen-vue-flutter.html" class="sidebar-link">CodePen vue SFC 、flutter 在线玩耍来袭</a></li><li><a href="/frontend/cors.html" class="sidebar-link">10种跨域解决方案（附终极方案）</a></li><li><a href="/frontend/11-must-website.html" class="sidebar-link"> 提高前端开发者效率的11个必备的网站</a></li><li><a href="/frontend/assign-spread.html" class="sidebar-link"> [译] Object.assign 和 Object Spread 之争, 用谁？</a></li><li><a href="/frontend/blog.html" class="sidebar-link">  教你如何搭建一个自动化构建的博客</a></li><li><a href="/frontend/css-lianglie.html" class="sidebar-link"> css实现左边定宽右边自适应的两列布局5种方法</a></li><li><a href="/frontend/css-loading.html" class="sidebar-link"> css3实现圆环加载进度条动画</a></li><li><a href="/frontend/debounce.html" class="sidebar-link"> debounce与throttle实现与原理</a></li><li><a href="/frontend/err-viewer.html" class="sidebar-link"> 教你如何打造出一个前端可视化监控系统</a></li><li><a href="/frontend/es2019.html" class="sidebar-link"> 🎉喜大普奔，ES2019登场</a></li><li><a href="/frontend/event.html" class="sidebar-link"> js中事件绑定3种方法以及事件委托</a></li><li><a href="/frontend/future-js.html" class="sidebar-link"> 未来的 JavaScript 应该是什么样的？现在还缺少什么？</a></li><li><a href="/frontend/git-err.html" class="sidebar-link"> git stderr(错误流)探秘</a></li><li><a href="/frontend/goabord.html" class="sidebar-link"> 肉身翻墙应该注意什么，一个澳洲程序员的自述</a></li><li><a href="/frontend/js-block.html" class="sidebar-link"> 你不知道的javascript之函数作用域和块作用域（一）</a></li><li><a href="/frontend/js-mouse.html" class="sidebar-link"> javascript中onmousemove、onmouseover、onmouseenter 的不同</a></li><li><a href="/frontend/js-op.html" class="sidebar-link"> 你不知道的javascript之运算符||和&amp;&amp;</a></li><li><a href="/frontend/js-proto.html" class="sidebar-link"> 你不知道的js类型转化和原型链</a></li><li><a href="/frontend/js-proto2.html" class="sidebar-link"> 你不知道的javascript之JS原型对象和原型链</a></li><li><a href="/frontend/js-sort.html" class="sidebar-link"> js实现表格排序</a></li><li><a href="/frontend/js-this.html" class="sidebar-link"> 你不知道的javascript之this的全面解析之绑定规则(一)</a></li><li><a href="/frontend/js-type.html" class="sidebar-link"> 你不知道的javascript之node类型详解</a></li><li><a href="/frontend/js-upload.html" class="sidebar-link"> 原生JS实现ajax上传文件并显示进度条</a></li><li><a href="/frontend/lazy-img.html" class="sidebar-link"> web上的原生图片懒加载(译)</a></li><li><a href="/frontend/leanboard.html" class="sidebar-link"> 《秋风日常第一期》白板协作工具 LeanBoard</a></li><li><a href="/frontend/learn.html" class="sidebar-link"> 前端学习历程</a></li><li><a href="/frontend/seo-img.html" class="sidebar-link"> 《秋风日常第二期》一个快速找出待SEO图片的技巧</a></li><li><a href="/frontend/vscode-x.html" class="sidebar-link"> 在 vscode 中写 Markdown 如何装X</a></li></ul> </aside> <!----> <!----> <main class="page"><div class="theme-default-content" style="margin-top:3.6rem;padding-top:0;padding-bottom:0;"><div class="bar-container"><div class="bar-intro"><div class="text"><p>阿里云优惠活动，点击链接进行购买: <a href="https://www.aliyun.com/minisite/goods?userCode=qtt5ztpk">一年仅需96.9元即可以购买服务器~ </a></p> <p>腾讯云优惠活动, 点击链接进行购买<a href="https://curl.qcloud.com/mcBHz0hb">一年仅需99元</a></p> <p>腾讯云限时开团活动, 点击链接进行购买<a href="https://cloud.tencent.com/act/cvmgift?hash=K468jiO7GIO6QaYN">一年仅需95元</a></p> <p><a href="/op/service-choice.html">各大服务器厂商对比选购</a></p></div></div></div> <!----></div> <div class="theme-default-content"><div class="content__default"><h1 id="从破解某定设计网站谈前端水印-详细教程"><a href="#从破解某定设计网站谈前端水印-详细教程" class="header-anchor">#</a> 从破解某定设计网站谈前端水印(详细教程)</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>最近在写公众号的时候，常常会自己做首图，并且慢慢地发现沉迷于制作首图，感觉扁平化的设计的真好好看。慢慢地萌生了一个做一个属于自己的首图生成器的想法。</p> <p><img src="https://s3.qiufeng.blue/blog/haibai-shuiyin.jpg?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="haibai-shuiyin"></p> <p>制作呢，当然也不是拍拍脑袋就开始，在开始之前，就去研究了一下<strong>某在线设计网站</strong>（如果有人不知道的话，可以说一下，这是一个在线制作海报之类的网站 T T 像我们这种内容创作者用的比较多），毕竟人家已经做了很久了，我只是想做个方便个人使用的。毕竟以上用 PS 做着还是有一些废时间，由于组成的元素都很简单，做一个自动化生成的完全可以。</p> <p>但是研究着研究着，就看到了<strong>某在线设计网站</strong>的水印，像这种技术支持的网站，最重要的防御措施就是水印了,<strong>水印能够很好的保护知识产权。</strong></p> <p>慢慢地路就走偏了，开始对它的水印感兴趣了。不禁发现之前只是大概知道水印的生成方法，但是从来没有仔细研究过，本文将以以下的路线进行讲解。以下所有代码示例均在</p> <blockquote><p>https://github.com/hua1995116/node-demo/tree/master/watermark</p></blockquote> <p><img src="https://s3.qiufeng.blue/blog/watermark-simple.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="watermark-simple"></p> <h2 id="明水印"><a href="#明水印" class="header-anchor">#</a> 明水印</h2> <blockquote><p><strong>水印</strong>（watermark）是一种容易识别、被夹于<a href="https://zh.wikipedia.org/wiki/%E7%BA%B8" target="_blank" rel="noopener noreferrer">纸<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>内，能够透过光线穿过从而显现出各种不同阴影的技术。</p></blockquote> <p>水印的类型有很多，有一些是整图覆盖在图层上的水印，还有一些是在角落。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128225753178.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128225753178"></p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128172843243.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128172843243"></p> <p><img src="https://s3.qiufeng.blue/blog/image-20201122184251938.png" alt="image-20201122184251938"></p> <p>那么这个水印怎么实现呢？熟悉 PS 的朋友，都知道 PS 有个叫做图层的概念。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201123230350901.png" alt="image-20201123230350901"></p> <p>网页也是如此。我们可以通过绝对定位，来将水印覆盖到我们的页面之上。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201123230659874.png" alt="image-20201123230659874"></p> <p>最终变成了这个样子。</p> <p><img src="https://s3.qiufeng.blue/blog/1606144217031.jpg" alt="1606144217031"></p> <p>等等，但是发现少了点什么。直接覆盖上去，就好像是一个蒙层，我都知道这样是无法触发底下图层的事件的，此时就要介绍一个css属性<code>pointer-events</code>。</p> <blockquote><p><strong><code>pointer-events</code></strong> CSS 属性指定在什么情况下 (如果有) 某个特定的图形元素可以成为鼠标事件的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/event.target" target="_blank" rel="noopener noreferrer">target<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></blockquote> <p>当它的被设置为 <code>none</code> 的时候，能让元素实体虚化，虽然存在这个元素，但是该元素不会触发鼠标事件。详情可以查看 <a href="https://www.zhangxinxu.com/wordpress/2011/12/css3-pointer-events-none-javascript/" target="_blank" rel="noopener noreferrer">CSS3 pointer-events:none应用举例及扩展 « 张鑫旭-鑫空间-鑫生活<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 。</p> <p>这下理清了实现原理，等于成功了一半了！</p> <p><img src="https://s3.qiufeng.blue/blog/72_c2ae29ca4f8c9769e1f8792146c8365c.jpg" alt="72_c2ae29ca4f8c9769e1f8792146c8365c"></p> <h3 id="明水印的生成"><a href="#明水印的生成" class="header-anchor">#</a> 明水印的生成</h3> <p>明水印的生成方式主要可以归为两类，一种是 纯 html 元素(纯div)，另一种则为背景图（canvas/svg）。</p> <p>下面我分别来介绍一下，两种方式。</p> <h3 id="div实现"><a href="#div实现" class="header-anchor">#</a> div实现</h3> <p>我们首先来讲比较简单的 div 生成的方式。就按照我们刚才说的。</p> <div class="language-html extra-class"><pre class="language-html"><code>// 文本内容
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>秋风<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>首先我们来生成一个水印块，就是上面的 一个个<code>秋风的笔记</code>。这里主要有一点就是设置一个透明度（为了让水印看起来不是那么明显，从而不遮挡我们的主要页面），另一个就是一个旋转，如果是正的水平会显得不是那么好看，最后一点就是使用 <code>userSelect</code> 属性，让此时的文字无法被选中。</p> <p><strong>userSelect</strong></p> <blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS" target="_blank" rel="noopener noreferrer">CSS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 属性 <code>user-select</code> 控制用户能否选中文本。除了文本框内，它对被载入为 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Chrome" target="_blank" rel="noopener noreferrer">chrome<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的内容没有影响。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">cssHelper</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> prototype</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> prototype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">.</span>style<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> prototype<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> item <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
item<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'秋风的笔记'</span>
<span class="token function">cssHelper</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  position<span class="token operator">:</span> <span class="token string">'absolute'</span><span class="token punctuation">,</span>
  top<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">50px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  left<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">50px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  fontSize<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">16px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  color<span class="token operator">:</span> <span class="token string">'#000'</span><span class="token punctuation">,</span>
  lineHeight<span class="token operator">:</span> <span class="token number">1.5</span><span class="token punctuation">,</span>
  opacity<span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
  transform<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rotate(-15deg)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  transformOrigin<span class="token operator">:</span> <span class="token string">'0 0'</span><span class="token punctuation">,</span>
  userSelect<span class="token operator">:</span> <span class="token string">'none'</span><span class="token punctuation">,</span>
  whiteSpace<span class="token operator">:</span> <span class="token string">'nowrap'</span><span class="token punctuation">,</span>
  overflow<span class="token operator">:</span> <span class="token string">'hidden'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>有了一个水印片，我们就可以通过计算屏幕的宽高，以及水印的大小来计算我们需要生成的水印个数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> waterHeight <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> waterWidth <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> clientWidth<span class="token punctuation">,</span> clientHeight <span class="token punctuation">}</span> <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token keyword">const</span> column <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>clientWidth <span class="token operator">/</span> waterWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rows <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>clientHeight <span class="token operator">/</span> waterHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> column <span class="token operator">*</span> rows<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrap <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cssHelper</span><span class="token punctuation">(</span>wrap<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        position<span class="token operator">:</span> <span class="token string">'relative'</span><span class="token punctuation">,</span>
        width<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>waterWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        height<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>waterHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        flex<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0 0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>waterWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        overflow<span class="token operator">:</span> <span class="token string">'hidden'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrap<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    waterWrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>wrap<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>waterWrapper<span class="token punctuation">)</span>
</code></pre></div><p>这样子我们就完美地实现了上面我们给出的思路的样子啦。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201130003407877.png" alt="image-20201130003407877"></p> <h3 id="背景图实现"><a href="#背景图实现" class="header-anchor">#</a> 背景图实现</h3> <h4 id="canvas"><a href="#canvas" class="header-anchor">#</a> canvas</h4> <p><code>canvas</code>的实现很简单，主要是利用<code>canvas</code> 绘制一个水印，然后将它转化为 base64 的图片，通过<code>canvas.toDataURL()</code> 来拿到文件流的 url ，关于文件流相关转化可以参考我之前写的文章<a href="https://juejin.cn/post/6867469476196155400" target="_blank" rel="noopener noreferrer">一文带你层层解锁「文件下载」的奥秘<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 然后将获取的 url 填充在一个元素的背景中，然后我们设置背景图片的属性为重复。</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.watermark</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
    <span class="token property">bottom</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
    <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">background-repeat</span><span class="token punctuation">:</span> repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createWaterMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> angle <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> txt <span class="token operator">=</span> <span class="token string">'秋风的笔记'</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">180</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'#000'</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>globalAlpha <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">16px serif</span><span class="token template-punctuation string">`</span></span>
  ctx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span> <span class="token operator">*</span> angle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>txt<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> watermakr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watermakr<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'watermark'</span><span class="token punctuation">;</span>
watermakr<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">createWaterMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>watermakr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="svg"><a href="#svg" class="header-anchor">#</a> svg</h4> <p>svg 和 canvas 类似，主要还是生成背景图片。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createWaterMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> svgStr <span class="token operator">=</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;180px&quot; height=&quot;100px&quot;&gt;
      &lt;text x=&quot;0px&quot; y=&quot;30px&quot; dy=&quot;16px&quot;
      text-anchor=&quot;start&quot;
      stroke=&quot;#000&quot;
      stroke-opacity=&quot;0.1&quot;
      fill=&quot;none&quot;
      transform=&quot;rotate(-20)&quot;
      font-weight=&quot;100&quot;
      font-size=&quot;16&quot;
      &gt;
      	秋风的笔记
      &lt;/text&gt;
    &lt;/svg&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data:image/svg+xml;base64,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span><span class="token function">btoa</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>svgStr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> watermakr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
watermakr<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'watermark'</span><span class="token punctuation">;</span>
watermakr<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">createWaterMark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>watermakr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="明水印的破解一"><a href="#明水印的破解一" class="header-anchor">#</a> 明水印的破解一</h3> <p>以上就很快实现了水印的几种方案。但是对于有心之人来说，肯定会想着破解，以上破解也很简单。</p> <p>打开了<code>Chrome Devtools</code> 找到对应的元素，直接按 <code>delete</code> 即可删除。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128175505927.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128175505927"></p> <h3 id="明水印的防御"><a href="#明水印的防御" class="header-anchor">#</a> 明水印的防御</h3> <p>这样子的水印对于大概知道控制台操作的小白就可以轻松破解，那么有什么办法能防御住这样的操作呢？</p> <p>答案是肯定的，js 有一个方法叫做 <code>MutationObserver</code>，能够监控元素的改动。</p> <p>MutationObserver 对现代浏览的兼容性还是不错的，MutationObserver是元素观察器，字面上就可以理解这是用来观察Node（节点）变化的。MutationObserver是在DOM4规范中定义的，它的前身是MutationEvent事件，最低支持版本为 ie9 ，目前已经被弃用。</p> <p><img src="https://s3.qiufeng.blue/blog/164f589be481b344.png" alt="img"></p> <p>在这里我们主要观察的有三点</p> <ul><li>水印元素本身是否被移除</li> <li>水印元素属性是否被篡改（display: none ...）</li> <li>水印元素的子元素是否被移除和篡改 （element生成的方式 ）</li></ul> <p>来通过 MDN 查看该方法的使用示例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> targetNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'some-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 观察器的配置（需要观察什么变动）</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span> attributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> childList<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> subtree<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 当观察到变动时执行的回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mutationsList<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Use traditional 'for loops' for IE 11</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> mutation <span class="token keyword">of</span> mutationsList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'childList'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A child node has been added or removed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'attributes'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The '</span> <span class="token operator">+</span> mutation<span class="token punctuation">.</span>attributeName <span class="token operator">+</span> <span class="token string">' attribute was modified.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个观察器实例并传入回调函数</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 以上述配置开始观察目标节点</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>targetNode<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>而<code>MutationObserver</code>主要是监听子元素的改动，因此我们的监听对象为 <code>document.body</code>, 一旦监听到我们的水印元素被删除，或者属性修改，我们就重新生成一个。通过以上示例，加上我们的思路，很快我们就写一个监听删除元素的示例。（监听属性修改也是类似就不一一展示了）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 观察器的配置（需要观察什么变动）</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span> attributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> childList<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> subtree<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 当观察到变动时执行的回调函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">mutationsList<span class="token punctuation">,</span> observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// Use traditional 'for loops' for IE 11</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> mutation <span class="token keyword">of</span> mutationsList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mutation<span class="token punctuation">.</span>removedNodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">===</span> watermakr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>watermakr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 监听元素</span>
<span class="token keyword">const</span> targetNode <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token comment">// 创建一个观察器实例并传入回调函数</span>
<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 以上述配置开始观察目标节点</span>
observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>targetNode<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们打开控制台来检验一下。</p> <p><img src="https://s3.qiufeng.blue/blog/2020-11-28-21.11.25.gif" alt="2020-11-28-21.11.25"></p> <p>这回完美了，能够完美抵御一些开发小白了。</p> <p>那么这样就万无一失了吗？显然，道高一尺魔高一丈，毕竟前端的一切都是不安全的。</p> <h3 id="明水印的破解二"><a href="#明水印的破解二" class="header-anchor">#</a> 明水印的破解二</h3> <p>在一个高级前端工程师面前，一切都是纸老虎。接下来我就随便介绍三种破解的方式。</p> <h4 id="第一种"><a href="#第一种" class="header-anchor">#</a> 第一种</h4> <p>打开<code>Chrome Devtools</code>，点击设置 - Debugger - Disabled JavaScript .</p> <p><img src="https://s3.qiufeng.blue/blog/1606569631600.jpg?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="1606569631600"></p> <p>然后再打开页面，<code>delete</code>我们的水印元素。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128212007999.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128212007999"></p> <h4 id="第二种"><a href="#第二种" class="header-anchor">#</a> 第二种</h4> <p>复制一个 body 元素，然后将原来 body 元素的删除。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128212148446.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128212148446"></p> <h4 id="第三种"><a href="#第三种" class="header-anchor">#</a> 第三种</h4> <p>打开一个代理工具，例如 <code>charles</code>，将生成水印相关的代码删除。</p> <h3 id="破解实践"><a href="#破解实践" class="header-anchor">#</a> 破解实践</h3> <p>接下来我们实战一下，通过预先分析，我们看到某在线设计网站的内容是以 div 的方式实现的，所以可以利用这种方案。 打开 https://www.gaoding.com/design?id=33931419&amp;simple=1  (仅供举例学习)</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128212301927.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128212301927"></p> <p>打开控制台，<code>Ctrl + F</code> 搜索 <code>watermark</code> 相关字眼。（这一步是作为一个程序员的直觉，基本上你要找什么，搜索对应的英文就可以 ~）</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128212425716.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128212425716"></p> <p>很快我们就找到了水印图。发现直接删除，没有办法删除水印元素，根据我们刚才学习的，肯定是利用了<code>MutationObserver</code>  方法。我们使用我们的第一个破解方法，将 JavaScript 禁用，再将元素删除。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128212612430.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128212612430"></p> <p>水印已经消失了。</p> <p>但是这样真的就万事大吉了吗？</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201123233342701.png" alt="image-20201123233342701"></p> <p>不知道你有没有听过一种东西，看不见摸不着，但是它却真实存在，他的名字叫做暗水印，我们将时间倒流到 16 年间的月饼门事件，因为有员工将内网站点截图了，但是很快被定位出是谁截图了。</p> <p><img src="https://pic1.zhimg.com/80/ba2894f9f99e05ec9219679512fbf362_1440w.jpg?source=1940ef5c" alt=""></p> <p>虽然你将一些可见的水印去除了，但是还会存在一些不可见的保护版权的水印。（这就是防止一些坏人拿去作另外的用途）</p> <h2 id="暗水印"><a href="#暗水印" class="header-anchor">#</a> 暗水印</h2> <blockquote><p>暗水印是一种肉眼不可见的水印方式，可以保持图片美观的同时，保护你的资源版权。</p></blockquote> <p>暗水印的生成方式有很多，常见的为通过修改<strong>RGB 分量值的小量变动</strong>、DWT、DCT 和 FFT 等等方法。</p> <p>通过介绍前端实现 <strong>RGB 分量值的小量变动</strong> 来揭秘其中的奥秘，主要参考 <a href="http://www.alloyteam.com/2016/03/image-steganography/#prettyPhoto" target="_blank" rel="noopener noreferrer">不能说的秘密——前端也能玩的图片隐写术 | AlloyTeam<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>我们都知道图片都是有一个个像素点构成的，每个像素点都是由 RGB 三种元素构成。当我们把其中的一个分量修改，人的肉眼是很难看出其中的变化，甚至是像素眼的设计师也很难分辨出。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128213551039.png" alt="image-20201128213551039"></p> <p>你能看出其中的差别吗？根据这个原理，我们就来实践吧。(女孩子可以掌握方法后可以拿以下图片进行试验测试)</p> <p><img src="https://s3.qiufeng.blue/blog/qiufeng-super.png" alt="qiufeng-super"></p> <p>首先拿到以上图片，我们先来讲解解码方式，解码其实很简单，我们需要创建一个规律，再通过我们的规律去解码。现在假设的规律为，我们将所有像素的 R 通道的值为奇数的时候我们创建的通道密码，举个简单的例子。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128220542389.png" alt="image-20201128220542389"></p> <p>例如我们把以上当做是一个图形，加入他要和一个中文的 &quot;一&quot; 放进图像，例如我们将 &quot;一&quot; 放入第二行。按照我们的算法，我们的图像会变成这个样子。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128220833657.png" alt="image-20201128220833657"></p> <p>解码的时候，我们拿到所有的奇数像素将它渲染出来，例如这里的 '5779' 是不是正好是一个 &quot;一&quot;，下面就转化为实践。</p> <h3 id="解码过程"><a href="#解码过程" class="header-anchor">#</a> 解码过程</h3> <p>首先创建一个 <code>canvas</code> 标签。</p> <div class="language-html extra-class"><pre class="language-html"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>256<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>256<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> originalData<span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// canvas像素信息</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  originalData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">processData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> originalData<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'qiufeng-super.png'</span><span class="token punctuation">;</span>
</code></pre></div><p>我们打印出这个数组，会有一个非常大的数组，一共有 256 * 256 * 4 = 262144 个值。因为每个像素除了 RGB 外还有一个 alpha 通道，也就是我们常用的透明度。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128215615494.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128215615494"></p> <p>上面也说了，我们的 R 通道为奇数的时候 ，就我们的解密密码。因此我们只需要所有的像素点的 R 通道为奇数的时候，将它填填充，不为奇数的时候就不填充，很快我们就能得到我们的隐藏图像。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">processData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> originalData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> originalData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// R分量</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// alpha通道不做处理</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 关闭其他分量，不关闭也不影响答案</span>
            data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将结果绘制到画布</span>
    ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>originalData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">processData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> originalData<span class="token punctuation">)</span>
</code></pre></div><p>解密完会出现类似于以下这个样子。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128220100175.png" alt="image-20201128220100175"></p> <p>那我们如何加密的，那就相反的方式就可以啦。(这里都用了 <a href="http://www.alloyteam.com/2016/03/image-steganography/" target="_blank" rel="noopener noreferrer">不能说的秘密——前端也能玩的图片隐写术<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中的例子，= = 我也能写出一个例子，但是觉得没必要，别人已经写得很好了，我们只是讲述这个方法，需要代码来举例而已)</p> <h3 id="编码过程"><a href="#编码过程" class="header-anchor">#</a> 编码过程</h3> <p>加密呢，首先我们需要获取加密的图像信息。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> textData<span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'30px Microsoft Yahei'</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token string">'秋风的笔记'</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
textData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
</code></pre></div><p>然后提取加密信息在待加密的图片上进行处理。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">mergeData</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> newData<span class="token punctuation">,</span> color<span class="token punctuation">,</span> originalData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> oData <span class="token operator">=</span> originalData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">var</span> bit<span class="token punctuation">,</span> offset<span class="token punctuation">;</span>  <span class="token comment">// offset的作用是找到alpha通道值，这里需要大家自己动动脑筋</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'R'</span><span class="token operator">:</span>
            bit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            offset <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'G'</span><span class="token operator">:</span>
            bit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            offset <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'B'</span><span class="token operator">:</span>
            bit <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            offset <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> oData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> bit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 只处理目标通道</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>newData<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>oData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 没有信息的像素，该通道最低位置0，但不要越界</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    oData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    oData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newData<span class="token punctuation">[</span>i <span class="token operator">+</span> offset<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>oData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// // 有信息的像素，该通道最低位置1，可以想想上面的斑点效果是怎么实现的</span>
                oData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>originalData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>主要的思路还是我一开始所讲的，在有像素信息的点，将 R 偶数的通道+1。在没有像素点的地方将 R 通道转化成偶数，最后在 <code>img.onload</code> 调用 <code>processData(ctx, originalData)</code> 。</p> <div class="language-js extra-class"><pre class="language-js"><code>img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取指定区域的canvas像素信息</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  originalData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>originalData<span class="token punctuation">)</span>
	<span class="token function">processData</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> originalData<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>以上方法就是一种比较简单的加密方式。以上代码都放到了仓库 <code>watermark/demo/canvas-dark-watermark.html</code> 路径下，方法都封装好了~。</p> <p>但是实际过程需要更专业的加密方式，例如利用傅里叶变化公式，来进行频域制定数字盲水印，这里就不详细展开讲了，以后研究完再详细讲~</p> <p><img src="https://images2015.cnblogs.com/blog/900740/201705/900740-20170501131510273-349045491.png" alt="img"></p> <h3 id="破解实践-2"><a href="#破解实践-2" class="header-anchor">#</a> 破解实践</h3> <p>听完上述的介绍，那么某在线设计网站是不是很有可能使用了暗水印呢？</p> <p>当然啦，通过我对某在线设计网站的分析，我分析了以下几种情况，我们一一来进行测试。</p> <p><img src="https://s3.qiufeng.blue/blog/%E6%9A%97%E6%B0%B4%E5%8D%B02.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="暗水印2"></p> <p>我们先通过免费下载的图片来进行分析。打开 https://www.gaoding.com/design?id=13964513159025728&amp;mode=user</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128230510959.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128230510959"></p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128230557383.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128230557383"></p> <p>通过实验（实验主要是去分析他各个场景下触发的请求），发现在下载免费图片的时候，发现它都会去向阿里云发送一个 POST 请求，这熟悉的请求域名以及熟悉的数据封装方式，这不就是 阿里云 OSS 客户端上传方式嘛。这就好办了，我们去查询一下阿里云是否有生成暗水印的相关方式，从而来看看某在线设计网站是否含有暗水印。很快我们就从官方文档搜索到了相关的文档，且对于低 QPS 是免费的。（这就是最好理解的连带效应，例如我们觉得耐克阿迪啥卖运动类服饰，你买了他的鞋子，可能还会想买他的衣服）</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128231110192.png?imageView2/0/q/75%7Cwatermark/1/image/aHR0cHM6Ly9zMy5xaXVmZW5naC5jb20vd2F0ZXJtYXJrL3dhdGVybWFyay5wbmc=/dissolve/50/gravity/SouthEast/dx/0/dy/0" alt="image-20201128231110192"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> RPCClient <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@alicloud/pop-core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RPCClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  endpoint<span class="token operator">:</span> <span class="token string">&quot;http://imm.cn-shenzhen.aliyuncs.com&quot;</span><span class="token punctuation">,</span>
  accessKeyId<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
  accessKeySecret<span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
  apiVersion<span class="token operator">:</span> <span class="token string">&quot;2017-09-06&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
          Project<span class="token operator">:</span> <span class="token string">&quot;test-project&quot;</span><span class="token punctuation">,</span>
          ImageUri<span class="token operator">:</span> <span class="token string">&quot;oss://watermark-shenzheng/source/20201009-182331-fd5a.png&quot;</span><span class="token punctuation">,</span>
            TargetUri<span class="token operator">:</span> <span class="token string">&quot;oss://watermark-shenzheng/dist/20201009-182331-fd5a-out.jpg&quot;</span><span class="token punctuation">,</span>
            Model<span class="token operator">:</span> <span class="token string">&quot;DWT&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;DecodeBlindWatermark&quot;</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>我们写了一个demo进行了测试。由于阿里云含有多种暗水印加密方式，为啥我使用了 <code>DWT</code> 呢？因为其他几种都需要原图，而我们刚才的测试，他上传只会上传一个文件到 OSS ，因此大致上排除了需要原图的方案。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128231801100.png" alt="image-20201128231801100"></p> <p>但是我们的结果却没有发现任何加密的迹象。</p> <p>为什么我们会去猜想阿里云的图片暗水印的方式？因为从上传的角度来考虑，我们上传的图片 key 的地址即是我们下载的图片，也就是现在存在两种情况，一就是通过阿里云的盲水印方案，另一种就是上传前进行了水印的植入。现在看来不是阿里云水印的方案，那么只是能是上传前就有了水印。</p> <p>这个过程就有两种情况，一是生成的过程中加入的水印，前端加入的水印。二是物料图含有水印。</p> <p>对于第一种情况，我们可以通过 <code>dom-to-image</code> 这个库，在前端直接进行下载，或者使用截图的方式。目前通过直接下载和通过站点内生成，发现元素略有不同。</p> <p><img src="https://s3.qiufeng.blue/blog/image-20201128235427912.png" alt="image-20201128235427912"></p> <p>第一个为我通过 <code>dom-to-image</code> 的方式下载，第二种为站点内下载，明显大了一些。（有点怀疑他在图片生成中可能做了什么手脚）</p> <p>但是感觉前端加密的方式比较容易破解，最坏的情况想到了对素材进行了加密，但是这样的话就无从破解了（但是查阅了一些资料，由于某在线设计网站站点素材大多是透明背景的，这种加密效果可能会弱一些，以后牛逼了再来补充）。目前这一块暂时还不清楚，探究止步于此了。</p> <h3 id="攻击实验"><a href="#攻击实验" class="header-anchor">#</a> 攻击实验</h3> <p>那如果一张图经过暗水印加密，他的抵抗攻击性又是如何呢？</p> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-out1.jpg" alt="1605680005172-out1"></p> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-decode2.jpg" alt="1605680005172-decode2"></p> <p>这是一张通过阿里云 <code>DWT</code>暗水印进行的加密，解密后的样子为&quot;秋风&quot;字样，我们分别来测试一下。</p> <h4 id="加一些元素"><a href="#加一些元素" class="header-anchor">#</a> 加一些元素</h4> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-out-el.jpg" alt="1605680005172-out-el"></p> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-decode-out-el.jpg" alt="1605680005172-decode-out-el"></p> <p>结果: 识别效果不错</p> <h4 id="截图"><a href="#截图" class="header-anchor">#</a> 截图</h4> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-out-cut1.jpg" alt="1605680005172-out-cut1"></p> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-decode-out-cut1.jpg" alt="1605680005172-decode-out-cut1"></p> <p>结果: 识别效果不错</p> <h4 id="大小变化"><a href="#大小变化" class="header-anchor">#</a> 大小变化</h4> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-out-scale.jpg" alt="1605680005172-out-scale"></p> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-out-decode-scale.jpg" alt="1605680005172-out-decode-scale"></p> <p>结果：识别效果不错</p> <h4 id="加蒙层"><a href="#加蒙层" class="header-anchor">#</a> 加蒙层</h4> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-out-bg.jpg" alt="1605680005172-out-bg"></p> <p><img src="https://s3.qiufeng.blue/blog/1605680005172-decode-out-bg.jpg" alt="1605680005172-decode-out-bg"></p> <p>结果： 直接就拉胯了。</p> <p><strong>可见，暗水印的抵抗攻击性还是蛮强的，是一种比较好的抵御攻击的方式~</strong></p> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>以上仅仅为技术交流~ 大家不要在实际的场景盲目使用，商业项目违规使用后果自负 ~ 或者期待一下我接下来想搞的这个个人免费首图生成器~ 喜欢文章的小伙伴可以点个赞哦 ~ 欢迎关注公众号 <strong>秋风的笔记</strong> ，学习前端不迷路。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p>https://imm.console.aliyun.com/cn-shenzhen/project?accounttraceid=1280c6af416744a38e9acf63c4e0878cjdet</p> <p>https://help.aliyun.com/document_detail/138800.html?spm=a2c4g.11186623.6.656.3bd46bb4oglhEr</p> <p>https://oss.console.aliyun.com/bucket/oss-cn-shenzhen/watermark-shenzheng/object?path=dist%2F</p> <p>https://juejin.cn/post/6844903650054111246</p> <p>https://www.zhihu.com/question/50677827/answer/122388524</p> <p>https://www.zhihu.com/question/50735753</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/8/2021, 1:38:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/chrome-frontend.html" class="prev">2021 chrome 插件推荐</a></span> <span class="next"><a href="/frontend/node-sass-eprecated.html">Node Sass 弃用，以 Dart Sass 代替</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="https://cdn.qiufeng.blue/assets/js/app.41b736e4.js" defer></script><script src="https://cdn.qiufeng.blue/assets/js/3.1c3cb04e.js" defer></script><script src="https://cdn.qiufeng.blue/assets/js/2.bf4393a2.js" defer></script><script src="https://cdn.qiufeng.blue/assets/js/73.6f122591.js" defer></script>
  </body>
</html>
