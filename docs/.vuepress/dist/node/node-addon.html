<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> Node + NAPI 实现 C++ 扩展 - LRU 淘汰算法 | 秋风的笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fd8e413c5ce47d78c95f742fc41a7118";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <meta name="description" content="Node实现 C++ 插件，LRU 淘汰算法">
    <meta name="keywords" content="Node C++ LRU淘汰算法 NAPI">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/css/0.styles.4d3f24ea.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/app.7c9aa361.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/3.8063c28d.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/2.bf4393a2.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/88.f83eb3ab.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/10.00b71072.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/100.8e4e6b8d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/101.93618fe4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/102.a23fbef8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/103.0841510d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/104.e8623e77.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/105.a2b24389.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/106.d0cce2aa.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/107.bdc12a90.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/108.1457028e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/109.346c1cab.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/11.f579ef03.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/110.2dda94f3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/111.651dd1e6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/112.1f6fb42b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/113.2fe5ec1e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/114.928e4874.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/115.0d07909a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/116.a9b30b44.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/117.e75309be.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/118.880cdcc2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/119.89d7605e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/12.add6b35c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/120.51655563.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/121.577087f1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/122.34a8dd52.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/123.edcb9df1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/124.639f41e3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/125.a20638ae.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/126.e34736f4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/127.e4502464.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/128.dc014a11.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/129.8f79e789.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/13.8b6a452a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/130.5af748b7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/131.53f0b101.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/132.bc074a48.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/133.5bf1d948.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/134.e7cc8343.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/135.25d0f7ea.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/136.06df954d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/137.d1a9d467.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/138.913d8d81.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/139.a3b1233a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/14.992d9387.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/140.bbe215fc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/141.1d45d1f7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/142.ec0d1f93.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/143.cec624e0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/144.99e1b82b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/145.a48d24dc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/146.2d6bdd14.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/147.785c6f34.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/148.62d3391c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/149.2ee242c0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/15.3f79a7f8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/150.5b4a0492.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/151.01f680b4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/152.96e718e3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/153.4fb4e18b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/16.f97f7bfd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/17.fc0e3d61.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/18.91b4e958.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/19.f3ae0ff0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/20.b2016673.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/21.538e7b8a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/22.7c8e0886.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/23.2e8b1e6f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/24.593e7364.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/25.4704368b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/26.f4c32fd6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/27.50707c84.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/28.2b74c2ea.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/29.bae4ec1f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/30.935966dc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/31.ff5ad70d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/32.682cdc0e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/33.0cba3dcc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/34.1a2ef44e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/35.714d9112.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/36.87e565e1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/37.4447a30e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/38.d506651f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/39.a0e5ec00.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/4.027465de.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/40.561038c8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/41.3d61545b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/42.a2d059b7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/43.838bb5b0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/44.f76381b4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/45.ba596489.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/46.2bbd32d8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/47.de787e88.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/48.afc831d0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/49.505ad87e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/5.dc096b09.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/50.a69b5bc7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/51.dcd80e19.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/52.b6a2d0d4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/53.3cc44113.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/54.c1cc9a64.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/55.3c776d88.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/56.93aadcaf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/57.1971cf51.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/58.c58c2d26.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/59.a6657d3a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/6.9c496f25.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/60.fbe83a41.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/61.4eb8f9a4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/62.63ac632a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/63.383bd652.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/64.509bbce7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/65.4860422b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/66.c61dcdca.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/67.591958d6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/68.a0fc9704.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/69.1f336f9a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/7.5cceb66b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/70.3d76a686.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/71.748479ff.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/72.dfb093f7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/73.2e835294.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/74.0b7a8158.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/75.03b9b151.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/76.a21f020a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/77.26ddf3a4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/78.54eeeae1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/79.a62b7742.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/8.09c2e0dd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/80.59b37bdf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/81.560b1637.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/82.5cd13ab5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/83.7013cadb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/84.a67136dd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/85.0f24347d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/86.f8d4ccac.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/87.f6c58fc3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/89.f3b7cfbb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/9.4b6ccd84.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/90.d12e9a47.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/91.1c94697f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/92.f3b6e6fa.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/93.b73d69ad.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/94.f5f030f3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/95.3c9b58a8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/96.da219a55.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/97.ea7a9aa5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/98.5b65a57c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/99.1eaffb49.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/css/0.styles.4d3f24ea.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">秋风的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端系列" class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">js文章</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">react实践</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue实践</a></li><li class="dropdown-item"><!----> <a href="/debug/" class="nav-link">debug系列</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">webpack系列</a></li><li class="dropdown-item"><!----> <a href="/canvas/" class="nav-link">canvas系列</a></li></ul></div></div><div class="nav-item"><a href="/svelte/" class="nav-link">Svelte系列</a></div><div class="nav-item"><a href="/three/" class="nav-link">Three.js系列</a></div><div class="nav-item"><a href="/node/" class="nav-link router-link-active">Node系列</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/op/" class="nav-link">前端运维</a></div><div class="nav-item"><a href="/open/" class="nav-link">开源项目</a></div> <a href="https://github.com/hua1995116/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端系列" class="dropdown-title"><span class="title">前端系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">js文章</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">react实践</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link">vue实践</a></li><li class="dropdown-item"><!----> <a href="/debug/" class="nav-link">debug系列</a></li><li class="dropdown-item"><!----> <a href="/webpack/" class="nav-link">webpack系列</a></li><li class="dropdown-item"><!----> <a href="/canvas/" class="nav-link">canvas系列</a></li></ul></div></div><div class="nav-item"><a href="/svelte/" class="nav-link">Svelte系列</a></div><div class="nav-item"><a href="/three/" class="nav-link">Three.js系列</a></div><div class="nav-item"><a href="/node/" class="nav-link router-link-active">Node系列</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试</a></div><div class="nav-item"><a href="/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/op/" class="nav-link">前端运维</a></div><div class="nav-item"><a href="/open/" class="nav-link">开源项目</a></div> <a href="https://github.com/hua1995116/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div style="padding-left:1.5rem;"><div class="qr"><img src="https://s3.qiufeng.blue/blog/erweima.jpg" alt="秋风的比较" width="120" height="120" loading="lazy"> <p class="we-intro">
    如果你对前端，Node，开源项目感兴趣请关注我的公众号 <a target="_blank" href="https://mp.weixin.qq.com/s/pKoliWlgtV-qm6orbyTz0Q">秋风的笔记</a>。
  </p></div></div> <ul class="sidebar-links"><li><a href="/node/mutiple-download.html" class="sidebar-link">前端多线程大文件下载实践，提速10倍+</a></li><li><a href="/node/file-download.html" class="sidebar-link">一文带你层层解锁「文件下载」的奥秘</a></li><li><a href="/node/upload.html" class="sidebar-link"> 一文了解文件上传全过程（1.8w字深度解析，进阶必备）</a></li><li><a href="/node/color.html" class="sidebar-link"> 让浏览器添上终端的彩</a></li><li><a href="/node/crawler.html" class="sidebar-link"> 手把手教你多页面递归爬虫--基于Node.Js</a></li><li><a href="/node/node-addon.html" aria-current="page" class="active sidebar-link"> Node + NAPI 实现 C++ 扩展 - LRU 淘汰算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/node-addon.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#插件编写方式" class="sidebar-link">插件编写方式</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#lru算法介绍" class="sidebar-link">LRU算法介绍</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#c-实现" class="sidebar-link">C++实现</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#node-addons-设计实现" class="sidebar-link">Node Addons 设计实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/node-addon.html#功能" class="sidebar-link">功能</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#项目结构" class="sidebar-link">项目结构</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#步骤" class="sidebar-link">步骤</a></li></ul></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#如何运行" class="sidebar-link">如何运行</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#如何调试" class="sidebar-link">如何调试</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#如何发布" class="sidebar-link">如何发布</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#比较效率" class="sidebar-link">比较效率</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/node/node-addon.html#欢迎关注公众号" class="sidebar-link">欢迎关注公众号</a></li></ul></li><li><a href="/node/node-cli-count.html" class="sidebar-link"> 开发一个Node小玩具全过程</a></li><li><a href="/node/node-git-down.html" class="sidebar-link"> 对症下药，快速下载github单个文件夹</a></li><li><a href="/node/pkg.html" class="sidebar-link"> pkg版本规范管理自动化最佳实践</a></li><li><a href="/node/shark-cleaner.html" class="sidebar-link"> shark-cleaner: 一个Node Cli 实现的垃圾清理工具(深层清理开发垃圾)</a></li><li><a href="/node/translate.html" class="sidebar-link"> 一个免费功能强大的谷歌翻译api</a></li></ul> </aside> <!----> <!----> <main class="page"><div class="theme-default-content" style="margin-top:3.6rem;padding-top:0;padding-bottom:0;"><div class="bar-container"><div class="bar-intro"><div class="text"><p>阿里云优惠活动，点击链接进行购买: <a href="https://www.aliyun.com/minisite/goods?userCode=qtt5ztpk">一年仅需96.9元即可以购买服务器~ </a></p> <p>腾讯云优惠活动, 点击链接进行购买<a href="https://curl.qcloud.com/mcBHz0hb">一年仅需99元</a></p> <p>腾讯云限时开团活动, 点击链接进行购买<a href="https://cloud.tencent.com/act/cvmgift?hash=K468jiO7GIO6QaYN">一年仅需95元</a></p> <p><a href="/op/service-choice.html">各大服务器厂商对比选购</a></p></div></div></div> <!----></div> <div class="theme-default-content"><div class="content__default"><h1 id="node-napi-实现-c-扩展-lru-淘汰算法"><a href="#node-napi-实现-c-扩展-lru-淘汰算法" class="header-anchor">#</a> Node + NAPI 实现 C++ 扩展 - LRU 淘汰算法</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>前段实践了一下 Node 的 C++ 编写，对于底层的编程实践是每个程序员心中所向往的圣地。由于接触的 Node C++ 的时间比较少，可能还无法完全理解其中的精髓，但是本文只记录自己的一个实践。</p> <p>先来看看 Node Addons 在整个模块中的所处的位置。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35abf06cbb090?w=879&amp;h=615&amp;f=jpeg&amp;s=35467" alt=""></p> <p>Addons 是用 C ++编写的动态链接的共享对象。 require() 函数可以将 Addons 加载为普通的Node.js模块，Addons 提供 JavaScript 和 C / C ++ 库之间的接口。</p> <h2 id="插件编写方式"><a href="#插件编写方式" class="header-anchor">#</a> 插件编写方式</h2> <p>在现代，Node 官方推荐的方式为以下三种, 插件编写历史可以查看 <a href="https://cnodejs.org/topic/5957626dacfce9295ba072e0" target="_blank" rel="noopener noreferrer">《<strong>从暴力到 NAN 再到 NAPI——Node.js 原生模块开发方式变迁</strong>》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>1.NAN (一个充满宏和实用工具的头文件，使Node.js的插件开发在0.8、0.10、0.12、1、2、3、4、5、6、7、8、9、10、11、12和13版本之间更容易。)</p></li> <li><p>2.NAPI   (N-API（在字母中发音为N，后跟API）是用于构建本机插件的API。 它独立于底层JavaScript运行时（例如V8），并作为Node.js本身的一部分进行维护。)</p></li> <li><p>3.直接使用内部的 V8、Libuv 和 Node.js库（需要掌握 V8,  libuv, Node 原生库方法，Node.js包括其他静态链接的库，包括OpenSSL ）</p></li></ul> <p>如果你不使用 NAPI 的未公开的 API，优先使用 NAPI 进行插件开发。</p> <p><strong>NAN 和 NAPI 的区别</strong></p> <p>NAN 解决了混乱的C++原生模块，不再让一个模块只能被若干个 Node 版本使用，而提出使用宏定义来解决这个问题，所以说NAN是一大堆宏定义，兼容各种 Node 版本的宏定义。做到了<code>一次编写，到处编译</code>。</p> <p>而这种设计模式还是依然有缺点，那就是多次编译，也就是说你写的插件如果到了更高的 Node 版本，还是需要再次编译，因此有来额 NAPI，它旨在使 Addons 与基础 JavaScript 引擎的更改保持隔离，并使为一个主要版本编译的模块可以在 Node 的更高主要版本上运行，而<code>无需重新编译</code>。</p> <p>随着时代的前进，我当然选择了最新的 NAPI 进行实践，虽然最新的 API 的封装地非常友好，看起来编写已经不是那么复杂，但是对于深入理解V8 以及Node原生模块来说，提升没有从更下层编写来的大。不过，这也不妨碍我们的学习，我们先来看看上层的实践，快速搭建应用，然后慢慢地去理解整个过程，也是一个非常好的方式。</p> <p>还有一点就是，N-API是一个 C API，确保 <a href="https://nodejs.org/en/docs/guides/abi-stability/" target="_blank" rel="noopener noreferrer">ABI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 跨Node.js版本和不同编译器级别的稳定性。C++ API更容易使用。为了支持使用 C++，该项目维护了一个名为 <a href="https://github.com/nodejs/node-addon-api" target="_blank" rel="noopener noreferrer">node-addon-api<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的 C++ 包装器模块。因此我们会使用进行包装后的 <code>node-addon-api</code> 来进行开发。</p> <p><strong>本文使用的环境</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&gt; g++ --verison
Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk/usr/include/c++/4.2.1
Apple LLVM version 10.0.0 (clang-1000.11.45.5)
Target: x86_64-apple-darwin18.0.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin

&gt; node -v
v10.16.0

&gt; sw_vers
ProductName:	Mac OS X
ProductVersion:	10.14
ProductName:	Mac OS X
ProductVersion:	10.14
BuildVersion:	18A391
</code></pre></div><h2 id="lru算法介绍"><a href="#lru算法介绍" class="header-anchor">#</a> LRU算法介绍</h2> <p>既然要实现一个 LRU，那必须对这个算法有一个初步的了解。LRU(Least Recently Used 意思为 <strong>最近最少使用</strong>)</p> <p>以内存访问为例解释缓存的工作原理。假设缓存的大小固定，初始状态为空。每发生一次读内存操作，首先查找待读取的数据是否存在于缓存中，若是，则缓存命中，返回数据；若否，则缓存未命中，从内存中读取数据，并把该数据添加到缓存中。向缓存添加数据时，如果缓存已满，则需要删除访问时间最早的那条数据，这种更新缓存的方法就叫做LRU。</p> <p>可以用以下图来进行演示说明，假设我们最多只能开3个应用，第一次我们开了知乎，然后知乎为最近使用，第二次，我们点击了qq音乐，然后我们的qq音乐会成为最近使用的应用。最后我们又打开了美团，此时爱奇艺应用被删除，美团成为最近使用的应用。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35ac914206c2b?w=500&amp;h=1334&amp;f=jpeg&amp;s=121421" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35ace6aaa545a?w=500&amp;h=1334&amp;f=jpeg&amp;s=127337" alt=""></p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35ad3e731808d?w=500&amp;h=1334&amp;f=jpeg&amp;s=111771" alt=""></p> <p>为了实现 LRU，我们需要保证他的读写性能。理想状态为在 <code>O(1)</code> 的时间内读取或者更新一条数据。通过这个现象我们可以使用 HashMap 来实现这个存储，根据键值访问可以达到 <code>O(1)</code> 的速度。现在还差更新数据，由于我们需要确定最早的那条数据，所以我们需要遍历所有数据。</p> <p>首先我们可以想到链表是一种有顺序的数据结构，其次由于我们被访问的数据有可能为非首尾结点，所以我们需要使用双向链表，来保证我们可以从中间任意结点修改链表。</p> <p>现在我们确定了我们的数据结构为  HashMap + 双向链表。</p> <p>我用图来描述一下整个过程，假设我们总长度为4。（左侧为双向链表，右侧为HashMap）</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35ae4aae24006?w=1336&amp;h=734&amp;f=jpeg&amp;s=122171" alt=""></p> <h2 id="c-实现"><a href="#c-实现" class="header-anchor">#</a> C++实现</h2> <p>由于一开始对 Node Addons 不太了解，因此先写了一个 c++ 版本，方便逻辑的调试。</p> <p><strong>list.h</strong></p> <div class="language-c++ extra-class"><pre class="language-text"><code>#include &lt;stdio.h&gt;
#include &lt;unordered_map&gt;
#include &lt;string&gt;
using namespace std;

class Node {
public:
    string data;
    Node *next;
    Node *prev;
    Node(string da, Node *p = NULL) {
        this-&gt;data = da;
        this-&gt;next = p;
    }
};
class List {
private:
    Node *head, *tail;
    int position;
    int count = 0;
    int maxCount = 200;
    unordered_map &lt;string, string&gt; cachemap;
public:
    List() {
        head = tail = NULL;
    };
    void SetMax(int da);
    void Print();
    void Insert (string da, string value);
    void Delete(string da);
    void Search(string da);
};
</code></pre></div><p><strong>list.cpp</strong></p> <div class="language-c++ extra-class"><pre class="language-text"><code>#include &lt;iostream&gt;
#include &quot;list.hpp&quot;
#include &lt;string&gt;
#include &lt;unordered_map&gt;

using namespace std;

void List::SetMax(int da) {
    maxCount = da;
}

void List::Print() {
    Node *p = head;
    
    while(p != NULL) {
        string key = p-&gt;data;
        unordered_map&lt;string ,string &gt;::iterator l_it;
        l_it = this-&gt;cachemap.find(key);
        
        if(l_it != this-&gt;cachemap.end()) {
            cout &lt;&lt; l_it-&gt;second &lt;&lt; endl;
        }
        p = p-&gt;next;
    }
}

void List::Delete(string da) {
    Node *p = head, *q = head;
    if(p == NULL) {
        cout &lt;&lt; &quot;can't find value %d&quot; &lt;&lt; da &lt;&lt; endl;
        return;
    }
    string value = &quot;&quot;;
    while (p != NULL) {
        if(p-&gt;data == da) {
            value = da;
            break;
        }
        q = p;
        p = p-&gt;next;
    }
    if(p == NULL) {
        cout &lt;&lt; &quot;del can't find value &quot; &lt;&lt; da &lt;&lt; endl;
    } else {
        q-&gt;next = p-&gt;next;
        cout &lt;&lt; &quot;del value &quot; &lt;&lt; da &lt;&lt; endl;
    }
}

void List::Insert(string da, string value) {
    if(count &gt;= maxCount) {
        tail-&gt;prev-&gt;next = NULL;
        tail = tail-&gt;prev;
        
        Node *p = new Node(da);
        cachemap.insert(pair&lt;string, string&gt;(da, value));
        p-&gt;next = head;
        head-&gt;prev = p;
        head = p;
        head-&gt;prev = NULL;
        
        return;
    }
    if(head == NULL) {
        head = tail = new Node(da);
        cachemap.insert(pair&lt;string, string&gt;(da, value));
        head-&gt;next = NULL;
        head-&gt;prev = NULL;
        tail-&gt;next = NULL;
        tail-&gt;prev = NULL;
    } else {
        Node *p = new Node(da);
        cachemap.insert(pair&lt;string, string&gt;(da, value));
        head-&gt;prev = p;
        p-&gt;next = head;
        p-&gt;prev = NULL;
        head = p;
    }
    count++;
}

void List::Search(string da) {
    Node *p = head;
    if(p == NULL) {
        cout &lt;&lt; &quot;can't find&quot; &lt;&lt; endl;
        return;
    }
    int count = -1;
    int i = 0;
    while( p!= NULL ) {
        if(p-&gt;data == da) {
            count = i;
            break;
        }
        p = p-&gt;next;
        i ++;
    }
    if(count != -1) {
        p-&gt;prev-&gt;next = p-&gt;next;
        if(p-&gt;next != NULL) {
            p-&gt;next-&gt;prev = p-&gt;prev;
        }
        p-&gt;next = head;
        p-&gt;prev = NULL;
        head-&gt;prev = p;
        head = p;
        unordered_map&lt;string ,string &gt;::iterator l_it;
        l_it = this-&gt;cachemap.find(da);
        if(l_it == this-&gt;cachemap.end()) {
            cout &lt;&lt; &quot;can't find key &quot; &lt;&lt; da &lt;&lt; endl;
        } else {
            cout &lt;&lt; &quot;find value is &quot; &lt;&lt; l_it-&gt;second &lt;&lt; endl;
        }
    } else {
        cout &lt;&lt; &quot;can't find key&quot; &lt;&lt; da &lt;&lt; endl;
    }
}
</code></pre></div><h2 id="node-addons-设计实现"><a href="#node-addons-设计实现" class="header-anchor">#</a> Node Addons 设计实现</h2> <h3 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h3> <p>1.设置缓存长度</p> <p>2.获取缓存长度</p> <p>3.打印所有缓存数据</p> <p>4.插入缓存数据</p> <p>5.获取缓存数据</p> <h3 id="项目结构"><a href="#项目结构" class="header-anchor">#</a> 项目结构</h3> <div class="language- extra-class"><pre class="language-text"><code>├── binding.gyp      // 编译配置
├── package.json  
├── src
│   ├── bingding.cc  // 声明模块导出
│   ├── list.cc      // 主入口
│   └── list.h       // 头文件声明
└── index.js         // 主文件入口
</code></pre></div><h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <h4 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> init -y
</code></pre></div><h4 id="创建binding-gpy"><a href="#创建binding-gpy" class="header-anchor">#</a> 创建binding.gpy</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;targets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;target_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LRU_node_addon&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;cflags!&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;-fno-exceptions&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;cflags_cc!&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;-fno-exceptions&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sources&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;./src/bingding.cc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./src/list.cc&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;include_dirs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;&lt;!@(node -p \&quot;require('node-addon-api').include\&quot;)&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      'defines'<span class="token operator">:</span> <span class="token punctuation">[</span> 'NAPI_DISABLE_CPP_EXCEPTIONS' <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="下载依赖"><a href="#下载依赖" class="header-anchor">#</a> <strong>下载依赖</strong></h4> <div class="language- extra-class"><pre class="language-text"><code>npm i bindings node-addon-api -S
</code></pre></div><p>注: <code>bingding</code> 是用来引入 c++ 模块，<code>node-addon-api</code> 是 NAPI 的 c++ 封装</p> <h4 id="导出模块"><a href="#导出模块" class="header-anchor">#</a> <strong>导出模块</strong></h4> <p>NAN模块的初始化是交给 Node.js 提供的宏来实现的：</p> <div class="language- extra-class"><pre class="language-text"><code>NODE_MODULE(addon, init)
</code></pre></div><p>而N-API使用自己的宏定义(<code>NAPI_MODULE</code>)，因为我们使用<code>node-addon-api</code>，所以它也对这个宏定义包裹成下面这个了：</p> <div class="language- extra-class"><pre class="language-text"><code>NODE_API_MODULE(addon, Init)
</code></pre></div><p>编写我们的导出模块 binding.cc</p> <div class="language-c++ extra-class"><pre class="language-text"><code>#include &lt;napi.h&gt;
#include &quot;list.h&quot;


Napi::Object InitAll(Napi::Env env, Napi::Object exports) {
  return List::Init(env, exports);
}

NODE_API_MODULE(NODE_GYP_MODULE_NAME, InitAll)
</code></pre></div><h4 id="改造主逻辑"><a href="#改造主逻辑" class="header-anchor">#</a> <strong>改造主逻辑</strong></h4> <p>做完了上述的准备工作，就可以开始改造我们的主逻辑，转化为 Node Addons ，主要还是因为 Node 无法直接调用 c++， 因此需要经过包装，我们的主要任务就是将 c++ 的类型包装为 v8 的类型，这一部分 node-addon-api 已经封装好，我们直接使用即可。（主要我写的这个比较简单，没有用到特别复杂的特性，主要作为一个小小的实践。）</p> <p><strong>修改声明文件</strong></p> <p>这里主要是对函数的返回值以及入参进行修改。</p> <p><strong>入参</strong>: <code>Napi::CallbackInfo</code> 主要为js 调用时传入的请求参数。</p> <p><strong>返回值</strong>: <code>Napi::Value</code>是 js 值的C ++表示。</p> <div class="language-c++ extra-class"><pre class="language-text"><code>...
class List : public Napi::ObjectWrap&lt;List&gt;{
private:
    Node *head, *tail;
    int count = 0;
    int maxCount = 200;
    unordered_map &lt;string, string&gt; cachemap;
public:
    static Napi::Object Init(Napi::Env env, Napi::Object exports); // 初始化
    static Napi::FunctionReference constructor; // 创建 FunctionReference ，防止被垃圾回收
    List(const Napi::CallbackInfo&amp; info); // 类构造函数
    void SetMax(const Napi::CallbackInfo&amp; info);
    Napi::Value getMax(const Napi::CallbackInfo&amp; info);
    Napi::Value Print(const Napi::CallbackInfo&amp; info);
    void Insert (const Napi::CallbackInfo&amp; info);
    Napi::Value Search(const Napi::CallbackInfo&amp; info);
}
...
</code></pre></div><p><strong>设置缓存长度</strong></p> <p>通过对 info 参数来获取 js 传入的参数。增加一些类型判断，如果非数字则想 js 抛出错误。</p> <div class="language-c++ extra-class"><pre class="language-text"><code>void List::SetMax(const Napi::CallbackInfo&amp; info) {
    int length = info.Length();
    Napi::Env env = info.Env();
     if (length &lt;= 0 || !info[0].IsNumber()) {
        Napi::TypeError::New(env, &quot;Number expected&quot;).ThrowAsJavaScriptException();
    }
    Napi::Number value = info[0].As&lt;Napi::Number&gt;();
    int cvalue = value.Int32Value();
    if(cvalue &lt; 10) {
        Napi::TypeError::New(env, &quot;min count is 10&quot;).ThrowAsJavaScriptException();
    }
    this-&gt;maxCount = cvalue;
}
</code></pre></div><p><strong>获取缓存长度</strong></p> <p>修改返回值为 <code>Napi::Value</code> 统一方式。</p> <div class="language-c++ extra-class"><pre class="language-text"><code>Napi::Value List::getMax(const Napi::CallbackInfo&amp; info) {
    int num = this-&gt;maxCount;
    return Napi::Number::New(info.Env(), num);
}
</code></pre></div><p><strong>打印所有缓存数据</strong></p> <p>通过对链表的迭代，获取所有数据并创建 <code>Napi::Array</code> 来进行存储。最后返回。</p> <div class="language-c++ extra-class"><pre class="language-text"><code>Napi::Value List::Print(const Napi::CallbackInfo&amp; info) {
    // array https://github.com/nodejs/node-addon-api/issues/423
    Node *p = this-&gt;head;
    Napi::Array arr = Napi::Array::New(info.Env(), this-&gt;count);
    int i = 0;
    while(p != NULL) {
        string key = p-&gt;data;
        unordered_map&lt;string ,string &gt;::iterator l_it;
        l_it = this-&gt;cachemap.find(key);

        if(l_it != this-&gt;cachemap.end()) {
            arr[i] = Napi::String::New(info.Env(), l_it-&gt;second);
        }
        i++;
        p = p-&gt;next;
    }
    return arr;
}
</code></pre></div><p><strong>插入缓存数据</strong></p> <p>修改点也比较少，主要就是</p> <p><code>info[0].As&lt;Napi::String&gt;()</code></p> <p><code>info[1].As&lt;Napi::String&gt;()</code></p> <p>用来获取 js 传入的参数，其他就是正常的数据类型改造。</p> <div class="language-c++ extra-class"><pre class="language-text"><code>void List::Insert(const Napi::CallbackInfo&amp; info) {
    int length = info.Length();
    Napi::Env env = info.Env();

     if (length &lt;= 1 || !info[0].IsString() || !info[1].IsString()) {
        Napi::TypeError::New(env, &quot;key and value expected&quot;).ThrowAsJavaScriptException();
    }
    Napi::String key = info[0].As&lt;Napi::String&gt;();
    Napi::String value = info[1].As&lt;Napi::String&gt;();

    string da = key.ToString();

    if(this-&gt;count &gt;= this-&gt;maxCount) {
        this-&gt;tail-&gt;prev-&gt;next = NULL;
        this-&gt;tail = this-&gt;tail-&gt;prev;
        
        Node *p = new Node(da);
        this-&gt;cachemap.insert(std::pair&lt;string, string&gt;(da, value));
        p-&gt;next = this-&gt;head;
        this-&gt;head-&gt;prev = p;
        this-&gt;head = p;
        this-&gt;head-&gt;prev = NULL;
        
        return;
    }
    if(this-&gt;head == NULL) {
        this-&gt;head = this-&gt;tail = new Node(da);
        this-&gt;cachemap.insert(std::pair&lt;string, string&gt;(da, value));
        this-&gt;head-&gt;next = NULL;
        this-&gt;head-&gt;prev = NULL;
        this-&gt;tail-&gt;next = NULL;
        this-&gt;tail-&gt;prev = NULL;
    } else {
        Node *p = new Node(da);
        this-&gt;cachemap.insert(std::pair&lt;string, string&gt;(da, value));
        this-&gt;head-&gt;prev = p;
        p-&gt;next = this-&gt;head;
        p-&gt;prev = NULL;
        this-&gt;head = p;
    }
    this-&gt;count++;
}
</code></pre></div><p><strong>获取缓存数据</strong></p> <p>获取到 js 传入 <code>key</code> 的后，通过循环链表查找是否存在改 <code>key</code>值，如果存在就去 map 中获取 <code>value</code></p> <div class="language-c++ extra-class"><pre class="language-text"><code>Napi::Value List::Search(const Napi::CallbackInfo&amp; info) {
    int length = info.Length();
    Napi::Env env = info.Env();

     if (length &lt;= 0 || !info[0].IsString()) {
        Napi::TypeError::New(env, &quot;String expected&quot;).ThrowAsJavaScriptException();
    }
    Napi::String value = info[0].As&lt;Napi::String&gt;();
    string da = value.ToString();

    Node *p = this-&gt;head;
    
    if(p == NULL) {
        return Napi::String::New(info.Env(), INITVALUE);
    }
    
    int count = -1;
    int i = 0;
    
    while( p!= NULL) {
        if(p-&gt;data == da) {
            count = i;
            break;
        }
        p = p-&gt;next;
        i ++;
    }
    if(count != -1) {
        p-&gt;prev-&gt;next = p-&gt;next;
        if(p-&gt;next != NULL) {
            p-&gt;next-&gt;prev = p-&gt;prev;
        }
        p-&gt;next = this-&gt;head;
        p-&gt;prev = NULL;
        this-&gt;head-&gt;prev = p;
        this-&gt;head = p;
        unordered_map&lt;string ,string &gt;::iterator l_it;
        l_it = this-&gt;cachemap.find(da);
        if(l_it == this-&gt;cachemap.end()) {
            return Napi::String::New(info.Env(), INITVALUE);
        } else {
            return Napi::String::New(info.Env(), l_it-&gt;second);
        }

    } else {
        return Napi::String::New(info.Env(), INITVALUE);
    }
    return Napi::String::New(info.Env(), INITVALUE);
}
</code></pre></div><h2 id="如何运行"><a href="#如何运行" class="header-anchor">#</a> 如何运行</h2> <p><strong>打包模式</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>node-gyp configure <span class="token operator">&amp;&amp;</span> node-gyp build 
</code></pre></div><p><strong>调试模式</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>node-gyp configure <span class="token operator">&amp;&amp;</span> node-gyp build --debug
</code></pre></div><p>通过 <code>node-gyp</code> 编译后, 会出现对应的  <code>build</code> 目录，打包模式 <code>build</code> 下面会有 一个 <code>Release</code> 目录，调试模式则是 <code>Debug</code> 目录。</p> <p><strong>运行测试文件</strong> <code>test.js</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> List <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;bindings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;LRU_node_addon&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">SetMax</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;12&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;13&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;14&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;15&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;16&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;17&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;18&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;19&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">&quot;21&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hi10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">Search</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>output</strong></p> <p>由于设置缓存最长长度为10，因为已经查找不到 <code>&quot;10&quot;</code> 这个 <code>key</code> 了。</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; 
&gt;[ 'hi10',
  'hi9',
  'hi8',
  'hi7',
  'hi6',
  'hi5',
  'hi4',
  'hi3',
  'hi2',
  'hi1' ]
</code></pre></div><h2 id="如何调试"><a href="#如何调试" class="header-anchor">#</a> 如何调试</h2> <p>以下都是基于 <code>vscode</code> 进行调试。</p> <p><strong>调试 Node</strong></p> <p>创建 <code>.vscode/launch.json</code>， 添加以下配置。<code>preLaunchTask</code> 为调试前运行的命令，保证每次调试的都是 最近的 c++ 扩展代码。（也可以去除这个文件）</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JS Debug Build&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;console&quot;</span><span class="token operator">:</span> <span class="token string">&quot;integratedTerminal&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;${workspaceFolder}/test.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;preLaunchTask&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm: build:debug&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后打上两个断点，在调试面板 找到 <code>JS Debug Build</code>。单击运行，就可以看到效果了。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35af65ac04df7?w=2630&amp;h=1760&amp;f=png&amp;s=936689" alt=""></p> <p><strong>调试 c++</strong></p> <p>vscode 默认不支持 <code>c/c++</code> 的调试，先安装 <code>c/c++</code> 插件。</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/24/16f35b035a076af0?w=1938&amp;h=924&amp;f=jpeg&amp;s=260246" alt=""></p> <p>添加配置</p> <div class="language- extra-class"><pre class="language-text"><code>{
        &quot;name&quot;: &quot;(lldb) Launch&quot;,
        &quot;type&quot;: &quot;cppdbg&quot;,
        &quot;request&quot;: &quot;launch&quot;,
        &quot;program&quot;: &quot;/Users/huayifeng/.nvm/versions/node/v10.16.0/bin/node&quot;,
        &quot;cwd&quot;: &quot;${workspaceFolder}&quot;,
        &quot;args&quot;: [
            &quot;${workspaceFolder}/test.js&quot;
        ],
        &quot;MIMode&quot;: &quot;lldb&quot;,
},
</code></pre></div><p>给 <code>list.cc</code> 打上断点。在调试面板 找到 <code>(lldb) Launch</code>。单击运行，就可以看到效果了。</p> <p><img src="https://s3.qiufeng.blue/blog/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7-2019-12-23-2.png" alt="屏幕快照-2019-12-23-2.png"></p> <h2 id="如何发布"><a href="#如何发布" class="header-anchor">#</a> 如何发布</h2> <p><strong>包版本管理</strong></p> <p>根据语义化版本管理（semantic-version）https://docs.npmjs.com/about-semantic-versioning</p> <blockquote><p>这里可以看我的另一个包 https://github.com/zerolty/auto-version 帮助你更好地管理版本。</p></blockquote> <p>为了帮助开发人员管理好依赖代码，我们建议你从 <code>1.0.0</code> 作为初始版本进行迭代。</p> <table><thead><tr><th>Code status</th> <th>Stage</th> <th>Rule</th> <th>Example version</th></tr></thead> <tbody><tr><td>First release</td> <td>New product</td> <td>Start with 1.0.0</td> <td>1.0.0</td></tr> <tr><td>Backward compatible bug fixes</td> <td>Patch release</td> <td>Increment the third digit</td> <td>1.0.1</td></tr> <tr><td>Backward compatible new features</td> <td>Minor release</td> <td>Increment the middle digit and reset last digit to zero</td> <td>1.1.0</td></tr> <tr><td>Changes that break backward compatibility</td> <td>Major release</td> <td>Increment the first digit and reset middle and last digits to zero</td> <td>2.0.0</td></tr></tbody></table> <blockquote><p>上述表格摘自 npm ，懒得翻译了。。。</p></blockquote> <p><strong>定义入口</strong></p> <p><code>package.json</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lru-node-addon&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build:debug&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-gyp configure &amp;&amp; node-gyp build --debug&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build:release&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-gyp configure &amp;&amp; node-gyp build&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;binding.gyp&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;gypfile&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;bindings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;~1.2.1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;node-addon-api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.0&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>发布</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm publish
</code></pre></div><p><img src="https://s3.qiufeng.blue/blog/1577073485544.jpg" alt="1577073485544.jpg"></p> <h2 id="比较效率"><a href="#比较效率" class="header-anchor">#</a> 比较效率</h2> <p><strong>时间</strong></p> <table><thead><tr><th></th> <th>100</th> <th>1000</th> <th>10000</th></tr></thead> <tbody><tr><td>Node</td> <td>1.828ms</td> <td>3.264ms</td> <td>42.393ms</td></tr> <tr><td>Addon</td> <td>0.605ms</td> <td>5.953ms</td> <td>525.639ms</td></tr></tbody></table> <p><strong>内存使用（heapUsed）</strong></p> <table><thead><tr><th></th> <th>100</th> <th>1000</th> <th>10000</th></tr></thead> <tbody><tr><td>Node</td> <td>3.96MB</td> <td>4.46MB</td> <td>6.72MB</td></tr> <tr><td>Addon</td> <td>3.90MB</td> <td>4.23MB</td> <td>5.45MB</td></tr></tbody></table> <p>测试发现随着数量的增加。用原生的 node 速度更快一些，但是内存占用更多。。 。这个回头再写一篇研究一下。还没有具体分析。。。</p> <p><strong>以上所有示例的 github 地址</strong></p> <p>https://github.com/hua1995116/LRU-node-addon</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p>https://juejin.im/post/5de484bef265da05ef59feb5</p> <p>https://www.jianshu.com/p/b1ab4a170c3c</p> <p>https://cnodejs.org/topic/5957626dacfce9295ba072e0</p> <p>https://github.com/nodejs/node-addon-api</p> <p>https://gyp.gsrc.io/docs/UserDocumentation.md</p> <p>https://www.ibm.com/developerworks/cn/opensource/os-cn-v8engine/</p> <p>https://nodejs.org/dist/latest/docs/api/n-api.html</p> <h2 id="欢迎关注公众号"><a href="#欢迎关注公众号" class="header-anchor">#</a> 欢迎关注公众号</h2> <p><img src="https://s3.qiufeng.blue/blog/gongzhonghao.png" alt=""></p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/8/2021, 1:38:24 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/node/crawler.html" class="prev"> 手把手教你多页面递归爬虫--基于Node.Js</a></span> <span class="next"><a href="/node/node-cli-count.html"> 开发一个Node小玩具全过程</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/app.7c9aa361.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/3.8063c28d.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/2.bf4393a2.js" defer></script><script src="https://cdn.jsdelivr.net/gh/hua1995116/vuepress-blog@master/docs/.vuepress/dist/assets/js/88.f83eb3ab.js" defer></script>
  </body>
</html>
