# æ•™ä½ å®ç°å¾®ä¿¡8.0ã€ç‚¸è£‚ã€çš„ğŸ‰è¡¨æƒ…ç‰¹æ•ˆ

## å†™åœ¨å¼€å¤´

æœ€è¿‘å¾®ä¿¡æ›´æ–°äº†8.0ï¼Œå…¶ä¸­ä¹‹ä¸€æœ€å¥½ç©çš„è«è¿‡äºè¡¨æƒ…åŒ…çš„æ›´æ–°äº†ï¼Œå¤§å®¶éƒ½åœ¨ç¾¤é‡Œçº·çº·ç©èµ·äº†è¡¨æƒ…åŒ…å¤§æˆ˜ã€‚

![](https://s3.qiufengh.com/blog/2021-02-01-23.44.16.gif)

ä½œä¸ºä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜ï¼Œè¿™å°±å‹¾èµ·äº†æˆ‘çš„å¥½å¥‡å¿ƒï¼Œè™½ç„¶æˆ‘ä»æ¥æ²¡æœ‰å®ç°è¿‡è¿™æ ·çš„åŠ¨ç”»ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¿ä¸ä½æƒ³è¦å»å®ç°ï¼Œæœ€ç»ˆæˆ‘èŠ±äº†2å¤©æ—¶é—´å»çœ‹ä¸€äº›åº“çš„æºç åˆ°æˆ‘è‡ªå·±å®ç°ä¸€ä¸ªç±»ä¼¼çš„æ•ˆæœï¼Œåœ¨è¿™é‡Œæˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œå¹¶ä¸”æ‰‹æŠŠæ‰‹åœ°æ•™å¤§å®¶æ€ä¹ˆå­¦ä¹ å®ç°ã€‚è€ŒğŸ‰æœ‰ä¸€ä¸ªè‡ªå·±çš„åå­—ï¼Œå«åš**äº”å½©çº¸å±‘**ï¼Œè‹±æ–‡åå­—å« `confetti`ã€‚

èŠå¤©å®¤+äº”å½©çº¸å±‘ç‰¹æ•ˆ åœ¨çº¿åœ°å€: https://www.qiufengh.com/#/

èŠå¤©å®¤Githubåœ°å€: https://github.com/hua1995116/webchat

äº”å½©çº¸å±‘Githubåœ°å€: https://github.com/hua1995116/node-demo/tree/master/confetti

![](https://s3.qiufengh.com/blog/image-20210206005938732.png)

![](https://s3.qiufengh.com/blog/2021-02-06-12.22.12.gif)

ç‰¹æ•ˆé¢„è§ˆï¼Œæ—¶é—´åŸå› æˆ‘åªå®ç°äº†å¹³è¡Œå››è¾¹å½¢çš„å½©è‰²å°å—ï¼Œå…¶ä»–å½¢çŠ¶çš„åŸç†ä¹Ÿæ˜¯ç±»ä¼¼ã€‚

![](https://s3.qiufengh.com/blog/2021-02-05-21.32.43.gif)

è¿˜å¯ä»¥è®¾ç½®æ–¹å‘

![](https://s3.qiufengh.com/blog/2021-02-05-21.37.32-1.gif)

## å‰æœŸç ”ç©¶

åœ¨å†™è¿™ä¸ªç‰¹æ•ˆå‰ï¼Œæˆ‘å‡ ä¹ä¸ä¼šç”¨canvasï¼Œè™½ç„¶è¯´ç°åœ¨ä¹Ÿä¸å¤ªä¼šç”¨ï¼Œå¾ˆå¤š API ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œå› æ­¤è¿™ç¯‡æ•™ç¨‹ä¹Ÿæ˜¯åŸºäºé›¶åŸºç¡€ canvas å†™çš„ï¼Œå¤§å®¶ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªæ•™ç¨‹éš¾åº¦å¤ªé«˜è€Œè¢«åŠé€€ã€‚æˆ‘ä¼šé€šè¿‡é›¶åŸºç¡€ canvas çš„åŸºç¡€ä¸Šæ¥ä¸€æ­¥æ­¥å®ç°çš„ã€‚ä¸è¿‡å­¦ä¹ è¿™ä¸ªç‰¹æ•ˆä¹‹å‰éœ€è¦ä¸€ç‚¹ç‚¹é«˜ä¸­æ•°å­¦çš„çŸ¥è¯†ï¼Œå¦‚æœä½ è¿˜è®°å¾— sin å’Œ cos å‡½æ•°ï¼Œé‚£ä¹ˆä»¥ä¸‹çš„å†…å®¹å¯¹äºä½ æ¥è¯´éƒ½ä¼šéå¸¸ç®€å•ï¼Œä¸ä¼šä¹Ÿæ²¡å…³ç³»~

æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢æ¢ç´¢ç ”ç©¶ï¼Œå¯¹æœ‰æ„æ€çš„ç©æ„å„¿å°±ä¼šå»ç ”ç©¶ï¼Œå› æ­¤æˆ‘ä¹Ÿæ˜¯ç«™åœ¨å·¨äººçš„åŸºç¡€ä¸Šï¼Œå» codepen æŸ¥äº†å¥½å¤šä¸ªç±»ä¼¼çš„å®ç°è¿›è¡Œç ”ç©¶ã€‚

![](https://s3.qiufengh.com/blog/codepen-id.gif)

æœ€ç»ˆå°†ç›®æ ‡å®šä½åœ¨äº† [canvas-confetti](https://github.com/catdad/canvas-confetti) ï¼Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªåº“å‘¢ï¼Ÿå› ä¸ºä»–çš„æ•ˆæœå¯¹äºæˆ‘ä»¬æ¥è¯´éå¸¸å¯ä»¥äº†ï¼Œè€Œä¸”å®ƒæ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œå¹¶ä¸”æ‹¥æœ‰äº† `1.3K` starï¼ˆæ„Ÿè§‰æ”¹å¤©å¯ä»¥åˆ†æåˆ†æå¤§ä½¬å®ç°åº“çš„åŸç†äº†~ï¼‰ï¼Œç»´æŠ¤é¢‘ç‡ä¹Ÿéå¸¸é«˜ã€‚

## æ ¸å¿ƒå®ç°

#### åˆ‡ç‰‡åœºæ™¯

é¦–å…ˆæ‹¿åˆ°è¿™ä¸ªåº“çš„æ—¶å€™ï¼Œæˆ‘æœ‰ç‚¹å¼€å¿ƒï¼Œå› ä¸ºè¿™ä¸ªåº“åªæœ‰ä¸€ä¸ªå•æ–‡ä»¶ã€‚

![](https://s3.qiufengh.com/blog/image-20210205215414389.png)

ä½†æ˜¯ï¼Œå½“æˆ‘æ‰“å¼€è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå‘ç°ä¸å¯¹...1ä¸ªæ–‡ä»¶**500è¡Œ**ä»£ç ï¼Œæˆ‘é€šè¿‡å‰¥ç¦»å±‚å±‚çš„ä¸€äº›è‡ªå®šä¹‰é…ç½®åŒ–çš„ä»£ç ï¼Œæœ€åæŠ½ç¦»å‡ºå•ä¸ªçº¸å±‘çš„è¿åŠ¨è½¨è¿¹ã€‚æˆ‘å°±å¼€å§‹ä¸æ–­åœ°åœ¨è§‚å¯Ÿå®ƒçš„è¿åŠ¨è½¨è¿¹...æ— é™å¾ªç¯çš„è§‚å¯Ÿ...

![](https://s3.qiufengh.com/blog/2021-02-05-21.56.33.gif)

å¯ä»¥çœ‹åˆ°å®ƒåœ¨åšä¸€ä¸ªç±»ä¼¼äºæŠ›ç‰©çº¿çš„è¿åŠ¨ï¼Œç„¶åæˆ‘ä¸€ä¸€å°†æºç ä¸­çš„å˜é‡è¿›è¡Œæ ‡æ³¨ï¼Œå†ç»“åˆæºç ã€‚

![](https://s3.qiufengh.com/blog/image-20210205215931549.png)

```js
fetti.x += Math.cos(fetti.angle2D) * fetti.velocity;
fetti.y += Math.sin(fetti.angle2D) * fetti.velocity + fetti.gravity;
```

ä»¥ä¸Šä»£ç çœ‹ä¸æ‡‚ä¹Ÿæ²¡äº‹ï¼Œæˆ‘åªæ˜¯è¯æ˜ä¸€ä¸‹æºç ä¸­çš„å†™æ³•ï¼Œå¹¶ä¸”æä¾›å­¦ä¹ æºç çš„ä¸€äº›æ€è·¯ï¼Œä»¥ä¸‹æ‰æ˜¯çœŸæ­£çš„å¼€è®²å®ç°ï¼

#### å¹³è¡Œå››è¾¹å½¢çš„å®ç°

å®ç°è¿™ä¸ªç‰¹æ€§å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ canvas å‡ ä¸ªå‡½æ•°ã€‚æ›´å¤šæŸ¥çœ‹ï¼ˆhttps://www.runoob.com/jsref/dom-obj-canvas.htmlï¼‰

**beginPath**

æ–¹æ³•å¼€å§‹ä¸€æ¡è·¯å¾„ï¼Œæˆ–é‡ç½®å½“å‰çš„è·¯å¾„ã€‚

**moveTo**

æŠŠè·¯å¾„ç§»åŠ¨åˆ°ç”»å¸ƒä¸­çš„æŒ‡å®šç‚¹ï¼Œä¸åˆ›å»ºçº¿æ¡ã€‚

**lineTo**

æ·»åŠ ä¸€ä¸ªæ–°ç‚¹ï¼Œç„¶ååœ¨ç”»å¸ƒä¸­åˆ›å»ºä»è¯¥ç‚¹åˆ°æœ€åæŒ‡å®šç‚¹çš„çº¿æ¡ã€‚

**closePath**

åˆ›å»ºä»å½“å‰ç‚¹å›åˆ°èµ·å§‹ç‚¹çš„è·¯å¾„ã€‚

**fill**

å¡«å……å½“å‰ç»˜å›¾ï¼ˆè·¯å¾„ï¼‰ã€‚

**fillStyle**

è®¾ç½®æˆ–è¿”å›ç”¨äºå¡«å……ç»˜ç”»çš„é¢œè‰²ã€æ¸å˜æˆ–æ¨¡å¼ã€‚



æ—¢ç„¶æˆ‘ä»¬è¦å®ç°äº”å½©çº¸å±‘ï¼Œé‚£ä¹ˆæˆ‘è‚¯å®šå¾—å…ˆå®ç°ä¸€ä¸ªçº¸å±‘ï¼Œæˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸ªå¹³è¡Œå››è¾¹å½¢çš„çº¸å±‘å§ï¼

æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ css ä¸­å®ç°å¹³è¡Œå››è¾¹å½¢å°±æ˜¯ä¸€ä¸ªdivï¼Œé»˜è®¤å°±æ˜¯ä¸€ä¸ªç›’å­ï¼Œè€Œåœ¨ canvas ä¸­å¹¶æ²¡æœ‰é‚£ä¹ˆæ–¹ä¾¿ï¼Œé‚£ä¹ˆæ€ä¹ˆå®ç°ä¸€ä¸ªå¹³è¡Œå››è¾¹å½¢å‘¢ï¼Ÿ

å››ä¸ªç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å››ä¸ªç‚¹ï¼Œå°±èƒ½ç¡®å®šä¸€ä¸ªå¹³è¡Œå››è¾¹å½¢ã€‚è€Œcanvasä¸­çš„åæ ‡ç³»å’Œæˆ‘ä»¬æ™®é€šçš„å†™ç½‘é¡µç•¥æœ‰ä¸åŒï¼Œå®ƒæ˜¯ä»å·¦ä¸Šè§’ä½œä¸ºèµ·å§‹ç‚¹ï¼Œä½†æ˜¯å¹¶ä¸å½±å“ã€‚

![](https://s3.qiufengh.com/blog/image-20210205222459958.png)

æˆ‘å¯ä»¥æ¥ç”»ä¸€ä¸ªå®½ä¸º20çš„å¹³è¡Œå››è¾¹å½¢ï¼Œ`(0, 0), (0, 20), (20,20), (20,0)`ã€‚

```js
...(çœç•¥äº†ä¸€äº›å‰ç½®åˆå§‹åŒ–ä»£ç )
var context = canvas.getContext('2d');
// æ¸…é™¤ç”»å¸ƒ
context.clearRect(0, 0, canvas.width, canvas.height);
// è®¾ç½®é¢œè‰²å¹¶å¼€å§‹ç»˜åˆ¶
context.fillStyle = 'rgba(2, 255, 255, 1)';
context.beginPath();
// è®¾ç½®å‡ ä¸ªç‚¹
var point1 = { x: 0, y: 0 }
var point2 = { x: 0, y: 20 }
var point3 = { x: 20, y: 20 }
var point4 = { x: 20, y: 0 }
// ç”»4ä¸ªç‚¹
context.moveTo(Math.floor(point1.x), Math.floor(point1.y));
context.lineTo(Math.floor(point2.x), Math.floor(point2.y));
context.lineTo(Math.floor(point3.x), Math.floor(point3.y));
context.lineTo(Math.floor(point4.x), Math.floor(point4.y));
// å®Œæˆè·¯çº¿ï¼Œå¹¶å¡«å……
context.closePath();
context.fill();
```

![](https://s3.qiufengh.com/blog/image-20210205223505901.png)

æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å…¶å®åªéœ€è¦ä¸€ä¸ªç‚¹å°±èƒ½ç¡®å®šè¿™ä¸ªå¹³è¡Œå››è¾¹å½¢çš„åˆå§‹ä½ç½®`(0, 0)`ï¼Œå¦‚æœå†çŸ¥é“ä¸€ä¸ªè§’åº¦`(90åº¦)`ã€ä»¥åŠå¹³è¡Œå››è¾¹å½¢çš„å˜é•¿(`20`)å°±èƒ½ç¡®å®šæ•´ä¸ªå¹³è¡Œå››è¾¹å½¢çš„ä½ç½®äº†ï¼(ä»…ä»…åªéœ€è¦åˆä¸­çŸ¥è¯†å°±èƒ½å®šä½æ•´ä¸ªå¹³è¡Œå››è¾¹å½¢)ã€‚

å¥½äº†ï¼Œä½ å­¦ä¼šç”»è¿™ä¸ªå·²ç»ç¦»æˆåŠŸè¿ˆå‘äº†ä¸€å¤§æ­¥ï¼æ˜¯ä¸æ˜¯æŒºç®€å•çš„~

å¤§ä½¬ä»¬å†…å¿ƒOS: å°±è¿™ï¼Ÿ

å—¯ï¼Œå°±è¿™ã€‚

#### è¿åŠ¨è½¨è¿¹

é€šè¿‡ä¸æ–­åœ°è°ƒè¯• [canvas-confetti](https://github.com/catdad/canvas-confetti) æ¯ä¸€å¸§çš„è½¨è¿¹è¿åŠ¨ï¼Œå‘ç°å®ƒå§‹ç»ˆåšçš„æ˜¯ä¸€ä¸ªxè½´å˜å‡é€Ÿè¿åŠ¨ï¼ˆç›´åˆ°é€Ÿåº¦ä¸º0å°±ä¸ç»§ç»­è¿åŠ¨äº†ï¼‰ï¼Œè€Œyè½´ä¹Ÿæ˜¯ä¸€ä¸ªå…ˆå˜å‡é€Ÿè¿åŠ¨å†æ˜¯ä¸€ä¸ªå‡é€Ÿè¿åŠ¨ï¼Œä»¥ä¸‹æ˜¯å¤§è‡´çš„è½¨è¿¹å›¾ã€‚

![](https://s3.qiufengh.com/blog/image-20210205221523845.png)

è¿™å°±æ˜¯ä»–çš„è¿åŠ¨è½¨è¿¹ï¼Œåˆ«ä»¥ä¸ºçœ‹ç€æŒºéš¾çš„ï¼Œä½†æ˜¯æ ¸å¿ƒä»£ç åªæœ‰ä¸‰å¥ã€‚

```js
// fetti.angle2Dä¸ºä¸€ä¸ªè§’åº¦ï¼ˆè¿™ä¸ªè§’åº¦ç¡®å®šäº†è¿åŠ¨è½¨è¿¹ 3 / 2 * Math.PI - 2 * Math.PIä¹‹é—´çš„ä¸€ä¸ªå€¼ï¼Œç”±äºè¦è®©è½¨è¿¹å¾€å·¦ä¸Šè§’ç§»åŠ¨ï¼Œå°±æ˜¯éƒ½è¦å¾€è´Ÿæ–¹å‘è¿åŠ¨ï¼Œå› æ­¤é€‰äº†ä»¥ä¸ŠèŒƒå›´ï¼‰ï¼Œ
// fetti.velocity ä¸ºä¸€ä¸ªåˆå§‹ä¸º50é•¿åº¦çš„å€¼ã€‚
// fetti.gravity = 3
fetti.x += Math.cos(fetti.angle2D) * fetti.velocity; // fetti.x ç¬¬ä¸€ä¸ªç‚¹çš„xåæ ‡
fetti.y += Math.sin(fetti.angle2D) * fetti.velocity + fetti.gravity; // fetti.y ç¬¬ä¸€ä¸ªç‚¹çš„yåæ ‡
fetti.velocity *= 0.8ï¼›
```

æ€»ç»“èµ·æ¥å°±æ˜¯ï¼Œç¬¬ä¸€ä¸ªåæ ‡ç‚¹çš„ x å‘¨å§‹ç»ˆåœ¨å¢åŠ ä¸€ä¸ªè´Ÿå€¼ï¼ˆMath.cos(3 / 2 * Math.PI - 2 * Math.PI) å§‹ç»ˆä¸ºè´Ÿå€¼ï¼‰ï¼Œè¿™ä¸ªå€¼åœ¨ä¸æ–­å‡å°ã€‚è€Œç¬¬ä¸€ä¸ªç‚¹çš„yè½´ä¹Ÿå§‹ç»ˆåœ¨åŠ ä¸€ä¸ªè´Ÿå€¼Math.cos(3 / 2 * Math.PI - 2 * Math.PI) å§‹ç»ˆä¸ºè´Ÿå€¼ï¼‰ï¼Œä½†æ˜¯ç”±äº `fetti.gravity`å§‹ç»ˆä¸ºæ­£å€¼ï¼Œå› æ­¤åˆ°äº†æŸä¸ªä¸´ç•Œç‚¹ï¼Œyçš„å€¼ä¼šä¸æ–­å¢åŠ ã€‚

æˆ‘æ¨¡æ‹Ÿäº†ä»¥ä¸‹çš„åæ ‡ï¼Œç”±äºä¸ºäº†è®©å¤§å®¶èƒ½æ˜ç™½è¿™ä¸ªè½¨è¿¹ï¼Œä»¥ä¸‹åæ ‡è½´å’Œcanvasä¸­ç›¸åï¼Œæ•°æ®æˆ‘ä¹Ÿåšäº†ç›¸åº”çš„å¤„ç†ï¼Œè¿›è¡Œäº†åæ–¹å‘å¤„ç†ã€‚

![](https://s3.qiufengh.com/blog/animation2.gif)

ç”¨ä¸€ä¸ªè¾¹ä¸Šä¸º10çš„æ­£æ–¹å½¢ï¼Œå®ç°è½¨è¿¹ã€‚

```js
const fetti = {
  "x": 445,
  "y": 541,
  "angle2D": 3 / 2 * Math.PI + 1 / 6 * Math.PI,
  "color": {r: 20, g: 30, b: 50},
  "tick": 0,
  "totalTicks": 200,
  "decay": 0.9,
  "gravity": 3,
  "velocity": 50
}
var animationFrame = null;
const update = () => {
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.fillStyle = 'rgba(2, 255, 255, 1)';
  context.beginPath();
  fetti.x += Math.cos(fetti.angle2D) * fetti.velocity; // ç¬¬ä¸€ä¸ªç‚¹
  fetti.y += Math.sin(fetti.angle2D) * fetti.velocity + fetti.gravity; // ç¬¬ä¸€ä¸ªç‚¹

  var x1 = fetti.x;
  var y1 = fetti.y;

  var x2 = fetti.x;// ç¬¬äºŒä¸ªç‚¹
  var y2 = fetti.y + 10; // ç¬¬äºŒä¸ªç‚¹

  var x3 = x1 + 10;
  var y3 = y1 + 10;

  var x4 = fetti.x + 10;
  var y4 = fetti.y;

  fetti.velocity *= fetti.decay;

  context.moveTo(Math.floor(x1), Math.floor(y1));
  context.lineTo(Math.floor(x2), Math.floor(y2));
  context.lineTo(Math.floor(x3), Math.floor(y3));
  context.lineTo(Math.floor(x4), Math.floor(y4));

  context.closePath();
  context.fill();
  animationFrame = raf.frame(update);
}
```

æ˜¯ä¸æ˜¯é™¤äº†é¢œè‰²å’Œå½¢çŠ¶ï¼Œæœ‰é‚£å‘³äº†ï¼Ÿ

![](https://s3.qiufengh.com/blog/2021-02-05-23.34.00.gif)

#### åè½¬ç‰¹æ•ˆ

é‚£ä¹ˆå¦‚ä½•å®ç°è®©è¿™ä¸ªä¸‹è½æ›´åŠ è‡ªç„¶ï¼Œä¼šæœ‰ä¸€ç§é£˜è½çš„æ„Ÿè§‰å‘¢ï¼Ÿ

å…¶å®ï¼Œä»–å°±æ˜¯ä¸€ç›´åœ¨åšä¸€ä¸ªç¿»è½¬ç‰¹æ•ˆ.

![](https://s3.qiufengh.com/blog/8-fanzhuan.gif)

å°†ä»–ä»¬æ‹†è§£å°±æ˜¯åœ¨åšç»•ç€ä¸€ä¸ªç‚¹çš„æ—‹è½¬è¿åŠ¨ï¼Œæ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸€è¾¹è‡ªæˆ‘ç¿»è½¬ä¸€è¾¹æŒ‰ç…§è¿åŠ¨è½¨è¿¹è¿›è¡Œç§»åŠ¨ã€‚

![](https://s3.qiufengh.com/blog/image-20210205234637817.png)

å®ç°è¿™ä¸ªç‰¹æ•ˆï¼Œå…¶å®ä¹‹å‰åœ¨å®ç°æ­£æ–¹å½¢çš„æ—¶å€™æåˆ°è¿‡ï¼Œå®ç°ä¸€ä¸ªæ­£æ–¹å½¢ã€‚æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªç‚¹èƒ½å®ç°ä¸€ä¸ªå¹³è¡Œå››è¾¹å½¢ã€‚

- çŸ¥é“ä¸€ä¸ªç‚¹çš„ä½ç½®

- çŸ¥é“ä¸€ä¸ªè§’åº¦

- çŸ¥é“ä¸€è¾¹è¾¹é•¿

ç›®å‰æˆ‘èƒ½ç¡®å®šçš„æœ‰ï¼Œä¸€ä¸ªç‚¹çš„ä½ç½®å¾ˆå®¹æ˜“ç¡®å®šï¼Œå°±æ˜¯æˆ‘ä»¬çš„èµ·å§‹ç‚¹ï¼Œç„¶åæˆ‘ä»¬è¾¹é•¿ä¹ŸçŸ¥é“ï¼Œå°±å·®ä¸€ä¸ªè§’åº¦äº†ï¼Œåªè¦æˆ‘ä»¬çš„è§’åº¦ä¸æ–­å˜åŒ–ï¼Œæˆ‘ä»¬å°±èƒ½å®ç°ä»¥ä¸Šç‰¹æ•ˆã€‚

```js
const update = () => {
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.fillStyle = 'rgba(2, 255, 255, 1)';
  context.beginPath();

  fetti.velocity *= fetti.decay;
  fetti.tiltAngle += 0.1 // ä¸æ–­ç»™è¿™ä¸ªå››è¾¹å½¢å˜åŒ–è§’åº¦

  var length = 10;

  var x1 = fetti.x;
  var y1 = fetti.y;

  var x2 = fetti.x + (length * Math.sin(fetti.tiltAngle));// ç¬¬äºŒä¸ªç‚¹
  var y2 = fetti.y + (length * Math.cos(fetti.tiltAngle)); // ç¬¬äºŒä¸ªç‚¹

  var x3 = x2 + 10;
  var y3 = y2;

  var x4 = fetti.x + length;
  var y4 = fetti.y;


  context.moveTo(Math.floor(x1), Math.floor(y1));
  context.lineTo(Math.floor(x2), Math.floor(y2));
  context.lineTo(Math.floor(x3), Math.floor(y3));
  context.lineTo(Math.floor(x4), Math.floor(y4));

  context.closePath();
  context.fill();
  animationFrame = raf.frame(update);
}

```

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ä»¥ä¸Šçš„ç‰¹æ•ˆã€‚

#### ç»„åˆè¿åŠ¨

ç„¶åæŠŠæˆ‘ä»¬ä»¥ä¸Šå†™çš„ç»„åˆåœ¨ä¸€èµ·å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰¹æ•ˆå•¦ã€‚

```js
const update = () => {
  context.clearRect(0, 0, canvas.width, canvas.height);
  context.fillStyle = 'rgba(2, 255, 255, 1)';
  context.beginPath();
  fetti.x += Math.cos(fetti.angle2D) * fetti.velocity; // ç¬¬ä¸€ä¸ªç‚¹
  fetti.y += Math.sin(fetti.angle2D) * fetti.velocity + fetti.gravity; // ç¬¬ä¸€ä¸ªç‚¹

  fetti.velocity *= fetti.decay;
  fetti.tiltAngle += 0.1 // ä¸æ–­ç»™è¿™ä¸ªå››è¾¹å½¢å˜åŒ–è§’åº¦

  var length = 10;

  var x1 = fetti.x;
  var y1 = fetti.y;

  var x2 = fetti.x + (length * Math.sin(fetti.tiltAngle));// ç¬¬äºŒä¸ªç‚¹
  var y2 = fetti.y + (length * Math.cos(fetti.tiltAngle)); // ç¬¬äºŒä¸ªç‚¹

  var x3 = x2 + 10;
  var y3 = y2;

  var x4 = fetti.x + length;
  var y4 = fetti.y;


  context.moveTo(Math.floor(x1), Math.floor(y1));
  context.lineTo(Math.floor(x2), Math.floor(y2));
  context.lineTo(Math.floor(x3), Math.floor(y3));
  context.lineTo(Math.floor(x4), Math.floor(y4));

  context.closePath();
  context.fill();
  animationFrame = raf.frame(update);
}
```

#### æœ€ç»ˆå½¢æ€

å¦‚æœæƒ³è¦å®ç°æœ€åçš„çŠ¶æ€ï¼Œå°±å·®`å¤šä¸ªå°å—`ã€`æ¸å˜æ¶ˆå¤±`ä»¥åŠ`éšæœºé¢œè‰²`äº†ï¼

è®¾ç½®å¤šå°‘å¸§æ¶ˆå¤±ï¼Œè¿™é‡Œæäº†ä¸¤ä¸ªå˜é‡`totalTicks`å’Œ`tick`ï¼Œè‡ªå®šä¹‰æ¥æ§åˆ¶å¤šå°‘å¸§åå°å—æ¶ˆå¤±ã€‚

è‡³äºå¤šä¸ªå°å—ï¼Œæˆ‘ä»¬åªéœ€è¦æä¸€ä¸ª for å¾ªç¯ã€‚

è€Œéšæœºé¢œè‰²ï¼Œæäº†ä¸€ä¸ª`colors`åˆ—è¡¨ã€‚

```js
const colors = [
  '#26ccff',
  '#a25afd',
  '#ff5e7e',
  '#88ff5a',
  '#fcff42',
  '#ffa62d',
  '#ff36ff'
];
var arr = []
for (let i = 0; i < 20; i++) {
  arr.push({
    "x": 445,
    "y": 541,
    "velocity": (45 * 0.5) + (Math.random() * 20),
    "angle2D": 3 / 2 * Math.PI + Math.random() * 1 / 4 * Math.PI,
    "tiltAngle":  Math.random() * Math.PI,
    "color": hexToRgb(colors[Math.floor(Math.random() * 7)]),
    "shape": "square",
    "tick": 0,
    "totalTicks": 200,
    "decay": 0.9,
    "random": 0,
    "tiltSin": 0,
    "tiltCos": 0,
    "gravity": 3,
  })
}
```

å®Œæ•´ä»£ç è¯·çœ‹

https://github.com/hua1995116/node-demo/blob/master/confetti/%E5%AE%8C%E6%95%B4demo.html

## åŠ ç‚¹é¤

å®ç°å¤šäººå¯¹æˆ˜å½¢æ€çš„è¡¨æƒ…å¤§æˆ˜ã€‚åœ¨æˆ‘ä»¬å¾®ä¿¡ä¸­è¡¨æƒ…çš„å‘é€å¹¶ä¸æ˜¯å•ç‚¹çš„ï¼Œè€Œæ˜¯å¤šäººå½¢æ€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢ç´¢ï¼Œåˆ©ç”¨ websocket å’Œå¤šå½©å°å—ç»“åˆã€‚

è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„å‡ ä¸ªç‚¹ã€‚ï¼ˆç”±äºç¯‡å¹…åŸå› å°±ä¸å¯¹ websocket å±•å¼€è®²è§£äº†ï¼Œæä¸€ä¸‹å®ç°è¦ç‚¹ï¼‰ã€‚

- æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª` tag` æ¥åŒºåˆ†æ˜¯å†å²æ¶ˆæ¯è¿˜æ˜¯å®æ—¶æ¶ˆæ¯
- åŒºåˆ†æ˜¯è‡ªå·±å‘å‡ºçš„æ¶ˆæ¯ï¼Œè¿˜æ˜¯å—åˆ°åˆ«äººçš„æ¶ˆæ¯ï¼Œæ¥æ”¹å˜äº”å½©çº¸å±‘æ–¹å‘ã€‚
- åªæœ‰ä¸ºå•ä¸ª ğŸ‰çš„æ—¶å€™æ‰ä¼šè¿›è¡ŒåŠ¨ç”»ã€‚
- å…ˆè¿›è¡Œæ”¾å¤§ç¼©å°çš„åŠ¨ç”»ï¼Œå»¶è¿Ÿ200mså†å‡ºæ¥ç‰¹æ•ˆ

```js
if(this.msg === 'ğŸ‰' && this.status) {
        this.confetti = true;
        const rect = this.$refs.msg.querySelector('.msg-text').getBoundingClientRect();
        if(rect.left && rect.top) {
          setTimeout(() => {
            confetti({
              particleCount: r(100, 150),
              angle: this.isSelf ? 120 : 60,
              spread: r(45, 80),
              origin: {
                x: rect.left / window.innerWidth,
                y: rect.top / window.innerHeight
              }
            });
          }, 200)
        }
}
```

![](https://s3.qiufengh.com/blog/2021-02-06%2012.20.07.gif)

## æ›´å¤šæ¢ç´¢

ç”¨ canvas ç»˜åˆ¶éå¸¸éå¸¸å¤šæ–¹å—çš„æ—¶å€™ï¼Œä¼šæ¯”è¾ƒå¡é¡¿ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ web worker æ¥è¿›è¡Œè®¡ç®—ï¼Œä»è€Œæé«˜æ€§èƒ½ï¼Œè¿™ä¸ªå°±è¯·è¯»è€…ä»¬è‡ªè¡Œæ¢ç´¢å•¦ï¼Œä¹Ÿå¯ä»¥çœ‹ `canvas-confetti`çš„æºç ~

## æœ€å

**å›çœ‹ç¬”è€…å¾€æœŸé«˜èµæ–‡ç« ï¼Œä¹Ÿè®¸èƒ½æ”¶è·æ›´å¤šå–”ï¼**

- [ä»ç ´è§£æŸè®¾è®¡ç½‘ç«™è°ˆå‰ç«¯æ°´å°(è¯¦ç»†æ•™ç¨‹)](https://juejin.cn/post/6900713052270755847)ï¼š`790+`ç‚¹èµé‡

- [ä»ç‹è€…è£è€€é‡Œæˆ‘å­¦ä¼šçš„å‰ç«¯æ–°æ‰‹æŒ‡å¼•](https://juejin.cn/post/6891053442530279432)ï¼š`260+`ç‚¹èµé‡

- [ä¸€æ–‡å¸¦ä½ å±‚å±‚è§£é”ã€Œæ–‡ä»¶ä¸‹è½½ã€çš„å¥¥ç§˜](https://juejin.cn/post/6867469476196155400)ï¼š`140+`ç‚¹èµé‡

- [10ç§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆé™„ç»ˆæå¤§æ‹›ï¼‰](https://juejin.cn/post/6844904126246027278)ï¼š`940+`ç‚¹èµé‡

- [ä¸€æ–‡äº†è§£æ–‡ä»¶ä¸Šä¼ å…¨è¿‡ç¨‹ï¼ˆ1.8wå­—æ·±åº¦è§£æï¼Œè¿›é˜¶å¿…å¤‡ï¼‰](https://juejin.cn/post/6844904106658643982)ï¼š`260+`ç‚¹èµé‡

  

## ç»“è¯­

**â¤ï¸å…³æ³¨+ç‚¹èµ+æ”¶è—+è¯„è®º+è½¬å‘â¤ï¸**ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œé¼“åŠ±ç¬”è€…åˆ›ä½œæ›´å¥½çš„æ–‡ç« 

**å…³æ³¨å…¬ä¼—å·`ç§‹é£çš„ç¬”è®°`ï¼Œä¸€ä¸ªä¸“æ³¨äºå‰ç«¯é¢è¯•ã€å·¥ç¨‹åŒ–ã€å¼€æºçš„å‰ç«¯å…¬ä¼—å·**

- å…³æ³¨åå›å¤`ç®€å†`è·å–100+å¥—çš„ç²¾ç¾ç®€å†æ¨¡æ¿
- å…³æ³¨åå›å¤`å¥½å‹`æ‹‰ä½ è¿›æŠ€æœ¯äº¤æµç¾¤+é¢è¯•äº¤æµç¾¤
- æ¬¢è¿å…³æ³¨`ç§‹é£çš„ç¬”è®°`

